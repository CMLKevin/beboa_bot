<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/443896d591e4f761-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/3cf59f0fd0496c15.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-e5714bf66625afb9.js"/><script src="/_next/static/chunks/fd9d1056-e1b8fc02af805f43.js" async=""></script><script src="/_next/static/chunks/117-bf803eaaef7a29e0.js" async=""></script><script src="/_next/static/chunks/main-app-b6379442ececfbb8.js" async=""></script><script src="/_next/static/chunks/972-68a674eeca97bbbb.js" async=""></script><script src="/_next/static/chunks/646-1e67c3e800eb58dd.js" async=""></script><script src="/_next/static/chunks/app/layout-4b75b78215e64ea2.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js" async=""></script><title>Migrations - Beboa Docs</title><link rel="icon" href="/favicon.ico"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_f367f3 __variable_a06722 font-sans"><div style="visibility:hidden"><div class="min-h-screen bg-[var(--bg-primary)] transition-colors duration-200"><header class="sticky top-0 z-40 w-full h-[var(--header-height)] bg-[var(--bg-secondary)] border-b border-[var(--border)]"><div class="flex items-center justify-between h-full px-4 lg:px-6"><div class="flex items-center gap-6"><button class="lg:hidden p-2 -ml-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu w-5 h-5"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><a class="flex items-center gap-2 text-lg font-semibold text-[var(--text-primary)] hover:text-[var(--accent)] transition-colors" href="/"><span class="text-xl">üêç</span><span class="hidden sm:inline">Beboa</span><span class="hidden sm:inline text-xs font-normal text-[var(--text-muted)] ml-1">Docs</span></a><nav class="hidden lg:flex items-center gap-1"><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/">User Guide</a><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/">AI Systems</a><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/">Jarvis Mode</a><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--accent)] bg-[var(--accent-light)]" href="/architecture/structure/">Reference</a></nav></div><div class="flex items-center gap-3"><div class="hidden sm:block"><button class="flex items-center gap-2 px-3 py-2 text-sm text-[var(--text-muted)] bg-[var(--bg-tertiary)] hover:bg-[var(--border)] rounded-lg border border-[var(--border)] transition-colors w-full max-w-[240px]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search w-4 h-4"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><span class="flex-1 text-left">Search docs...</span><kbd class="hidden sm:inline-flex items-center gap-0.5 px-1.5 py-0.5 text-xs font-medium text-[var(--text-muted)] bg-[var(--bg-secondary)] rounded border border-[var(--border)]"><span class="text-xs">‚åò</span>K</kbd></button></div><button class="sm:hidden p-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Search"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button><a href="https://github.com/CMLKevin/beboa_evo" target="_blank" rel="noopener noreferrer" class="hidden sm:flex p-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github w-5 h-5"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></a><button class="p-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Switch to dark mode"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon w-5 h-5"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg></button></div></div></header><aside class="fixed inset-y-0 left-0 z-50 w-72 bg-[var(--bg-secondary)] border-r border-[var(--border)] transform transition-transform duration-300 ease-in-out lg:hidden -translate-x-full"><div class="flex items-center justify-between h-[var(--header-height)] px-4 border-b border-[var(--border)]"><a class="flex items-center gap-2 text-lg font-semibold text-[var(--text-primary)]" href="/"><span class="text-xl">üêç</span><span>Beboa</span></a><button class="p-2 -mr-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Close menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x w-5 h-5"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button></div><div class="p-4 border-b border-[var(--border)]"><div class="flex flex-wrap gap-2"><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-tertiary)]" href="/">User Guide</a><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-tertiary)]" href="/ai/">AI Systems</a><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-tertiary)]" href="/jarvis/">Jarvis Mode</a><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--accent)] bg-[var(--accent-light)]" href="/architecture/structure/">Reference</a></div></div><nav class="overflow-y-auto h-[calc(100%-128px)] py-4 px-4"><ul class="space-y-1"><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Getting Started</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/">Home</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/getting-started/installation/">Installation</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/getting-started/configuration/">Configuration</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/getting-started/quickstart/">Quick Start</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Features</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/">Overview</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/checkins/">Daily Check-ins</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/bebits/">Bebits &amp; Rewards</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/chat/">AI Chat</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">AI Systems</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/">Overview</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/personality/">Dynamic Personality</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/moods/">Mood System</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/relationships/">Relationships</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/memory/">Semantic Memory</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/llm-evaluator/">LLM Evaluator</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/tools/">Tool Calls</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Jarvis Mode 2.0</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/">Overview</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/commands/">Commands Reference</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/parsing/">Intent Parsing</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/fun/">Fun Commands</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Commands</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/commands/user/">User Commands</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/commands/admin/">Admin Commands</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Architecture</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/structure/">Project Structure</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/database/">Database Schema</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/services/">Services</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/flow/">Message Flow</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Developer Guide</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/commands/">Extending Commands</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/tools/">Custom Tools</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--accent)] bg-[var(--accent-light)] font-medium" href="/dev/migrations/">Database Migrations</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/api/">API Reference</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Deployment</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/railway/">Railway</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/vps/">VPS Setup</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/docker/">Docker</a></li></ul></li></ul></nav></aside><div class="flex"><aside class="hidden lg:block fixed top-[var(--header-height)] left-0 bottom-0 w-[var(--sidebar-width)] border-r border-[var(--border)] bg-[var(--bg-secondary)] overflow-y-auto"><nav class="py-6 px-4"><ul class="space-y-6"><li><div class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Architecture</div><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/structure/">Project Structure</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/database/">Database Schema</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/services/">Services</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/flow/">Message Flow</a></li></ul></li><li><div class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Developer Guide</div><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/commands/">Extending Commands</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/tools/">Custom Tools</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/migrations/">Database Migrations</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/api/">API Reference</a></li></ul></li><li><div class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Deployment</div><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/railway/">Railway</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/vps/">VPS Setup</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/docker/">Docker</a></li></ul></li></ul></nav></aside><main class="flex-1 min-w-0 lg:pl-[var(--sidebar-width)]"><div class="max-w-[var(--content-max-width)] mx-auto px-6 py-8 lg:px-8 lg:py-12"><article class="animate-in"><div class="flex items-start justify-between gap-4 mb-6"><nav aria-label="Breadcrumb" class="flex items-center gap-1.5 text-sm mb-4"><div class="flex items-center gap-1.5"><a class="text-[var(--text-muted)] hover:text-[var(--text-primary)] transition-colors" href="/dev/commands/">Developer Guide</a></div></nav><button class="flex items-center gap-1.5 px-3 py-1.5 text-sm text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)] rounded-md transition-colors border border-transparent hover:border-[var(--border)]" title="Copy page content"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-4 h-4"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy page</span></button></div><h1>Migrations</h1><div class="prose-custom"><h1 id="database-migrations">Database Migrations</h1>
<p>Guide to safely updating the database schema.</p>
<h2 id="migration-system"><a href="#migration-system" class="anchor-link">Migration System</a></h2>
<p>Beboa uses a simple migration system to track schema changes:</p>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>data/</span></div><div class="px-4"><span>‚îú‚îÄ‚îÄ beboa.db           # Main database</span></div><div class="px-4"><span>‚îî‚îÄ‚îÄ migrations/        # Migration scripts (optional)</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h2 id="migration-table"><a href="#migration-table" class="anchor-link">Migration Table</a></h2>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">sql</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>CREATE TABLE IF NOT EXISTS migrations (</span></div><div class="px-4"><span>    id INTEGER PRIMARY KEY AUTOINCREMENT,</span></div><div class="px-4"><span>    name TEXT UNIQUE NOT NULL,</span></div><div class="px-4"><span>    applied_at TEXT DEFAULT CURRENT_TIMESTAMP</span></div><div class="px-4"><span>);</span></div></code></pre></div>
<h2 id="running-migrations"><a href="#running-migrations" class="anchor-link">Running Migrations</a></h2>
<p>Migrations run automatically on startup in <code>src/services/database.js</code>:</p>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>function runMigrations() {</span></div><div class="px-4"><span>    const migrations = [</span></div><div class="px-4"><span>        { name: &#x27;001_initial_schema&#x27;, up: migration001 },</span></div><div class="px-4"><span>        { name: &#x27;002_add_memories&#x27;, up: migration002 },</span></div><div class="px-4"><span>        { name: &#x27;003_add_chat_history&#x27;, up: migration003 },</span></div><div class="px-4"><span>        // Add new migrations here</span></div><div class="px-4"><span>    ];</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    for (const migration of migrations) {</span></div><div class="px-4"><span>        const applied = db.prepare(</span></div><div class="px-4"><span>            &#x27;SELECT 1 FROM migrations WHERE name = ?&#x27;</span></div><div class="px-4"><span>        ).get(migration.name);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>        if (!applied) {</span></div><div class="px-4"><span>            console.log(`[DB] Running migration: ${migration.name}`);</span></div><div class="px-4"><span>            migration.up(db);</span></div><div class="px-4"><span>            db.prepare(&#x27;INSERT INTO migrations (name) VALUES (?)&#x27;).run(migration.name);</span></div><div class="px-4"><span>        }</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<h2 id="writing-migrations"><a href="#writing-migrations" class="anchor-link">Writing Migrations</a></h2>
<h3 id="adding-a-column"><a href="#adding-a-column" class="anchor-link">Adding a Column</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>function migration004AddUserTimezone(db) {</span></div><div class="px-4"><span>    // Check if column exists</span></div><div class="px-4"><span>    const columns = db.pragma(&#x27;table_info(users)&#x27;);</span></div><div class="px-4"><span>    const hasTimezone = columns.some(c =&gt; c.name === &#x27;timezone&#x27;);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    if (!hasTimezone) {</span></div><div class="px-4"><span>        db.exec(`</span></div><div class="px-4"><span>            ALTER TABLE users</span></div><div class="px-4"><span>            ADD COLUMN timezone TEXT DEFAULT &#x27;UTC&#x27;</span></div><div class="px-4"><span>        `);</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<h3 id="adding-a-table"><a href="#adding-a-table" class="anchor-link">Adding a Table</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>function migration005AddAchievements(db) {</span></div><div class="px-4"><span>    db.exec(`</span></div><div class="px-4"><span>        CREATE TABLE IF NOT EXISTS achievements (</span></div><div class="px-4"><span>            id INTEGER PRIMARY KEY AUTOINCREMENT,</span></div><div class="px-4"><span>            user_id TEXT NOT NULL,</span></div><div class="px-4"><span>            achievement_id TEXT NOT NULL,</span></div><div class="px-4"><span>            unlocked_at TEXT DEFAULT CURRENT_TIMESTAMP,</span></div><div class="px-4"><span>            FOREIGN KEY (user_id) REFERENCES users(user_id),</span></div><div class="px-4"><span>            UNIQUE(user_id, achievement_id)</span></div><div class="px-4"><span>        );</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>        CREATE INDEX IF NOT EXISTS idx_achievements_user</span></div><div class="px-4"><span>        ON achievements(user_id);</span></div><div class="px-4"><span>    `);</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<h3 id="adding-an-index"><a href="#adding-an-index" class="anchor-link">Adding an Index</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>function migration006AddBebitIndex(db) {</span></div><div class="px-4"><span>    db.exec(`</span></div><div class="px-4"><span>        CREATE INDEX IF NOT EXISTS idx_users_bebits_desc</span></div><div class="px-4"><span>        ON users(bebits DESC)</span></div><div class="px-4"><span>    `);</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<h3 id="modifying-data"><a href="#modifying-data" class="anchor-link">Modifying Data</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>function migration007NormalizeUsernames(db) {</span></div><div class="px-4"><span>    // Get all users</span></div><div class="px-4"><span>    const users = db.prepare(&#x27;SELECT user_id, username FROM users&#x27;).all();</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Update each user</span></div><div class="px-4"><span>    const update = db.prepare(&#x27;UPDATE users SET username = ? WHERE user_id = ?&#x27;);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    for (const user of users) {</span></div><div class="px-4"><span>        if (user.username) {</span></div><div class="px-4"><span>            const normalized = user.username.toLowerCase().trim();</span></div><div class="px-4"><span>            update.run(normalized, user.user_id);</span></div><div class="px-4"><span>        }</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<h2 id="migration-best-practices"><a href="#migration-best-practices" class="anchor-link">Migration Best Practices</a></h2>
<h3 id="always-use-if-not-exists"><a href="#always-use-if-not-exists" class="anchor-link">Always Use IF NOT EXISTS</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Good</span></div><div class="px-4"><span>db.exec(&#x27;CREATE TABLE IF NOT EXISTS new_table (...)&#x27;);</span></div><div class="px-4"><span>db.exec(&#x27;CREATE INDEX IF NOT EXISTS idx_name ON table(column)&#x27;);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Bad - will fail if run twice</span></div><div class="px-4"><span>db.exec(&#x27;CREATE TABLE new_table (...)&#x27;);</span></div></code></pre></div>
<h3 id="check-before-altering"><a href="#check-before-altering" class="anchor-link">Check Before Altering</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>function safeAddColumn(db, table, column, definition) {</span></div><div class="px-4"><span>    const columns = db.pragma(`table_info(${table})`);</span></div><div class="px-4"><span>    const exists = columns.some(c =&gt; c.name === column);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    if (!exists) {</span></div><div class="px-4"><span>        db.exec(`ALTER TABLE ${table} ADD COLUMN ${column} ${definition}`);</span></div><div class="px-4"><span>        return true;</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span>    return false;</span></div><div class="px-4"><span>}</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Usage</span></div><div class="px-4"><span>safeAddColumn(db, &#x27;users&#x27;, &#x27;new_column&#x27;, &#x27;TEXT DEFAULT NULL&#x27;);</span></div></code></pre></div>
<h3 id="use-transactions-for-data-migrations"><a href="#use-transactions-for-data-migrations" class="anchor-link">Use Transactions for Data Migrations</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>function migration008ComplexDataMigration(db) {</span></div><div class="px-4"><span>    const transaction = db.transaction(() =&gt; {</span></div><div class="px-4"><span>        // Multiple operations</span></div><div class="px-4"><span>        db.exec(&#x27;UPDATE users SET status = &quot;active&quot; WHERE status IS NULL&#x27;);</span></div><div class="px-4"><span>        db.exec(&#x27;DELETE FROM old_table WHERE migrated = 1&#x27;);</span></div><div class="px-4"><span>        db.exec(&#x27;INSERT INTO new_table SELECT * FROM temp_table&#x27;);</span></div><div class="px-4"><span>    });</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    transaction();</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<h3 id="log-migration-progress"><a href="#log-migration-progress" class="anchor-link">Log Migration Progress</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>function migration009LargeMigration(db) {</span></div><div class="px-4"><span>    console.log(&#x27;[MIGRATION] Starting large migration...&#x27;);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    const total = db.prepare(&#x27;SELECT COUNT(*) as count FROM large_table&#x27;).get().count;</span></div><div class="px-4"><span>    let processed = 0;</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    const rows = db.prepare(&#x27;SELECT * FROM large_table&#x27;).all();</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    for (const row of rows) {</span></div><div class="px-4"><span>        // Process row</span></div><div class="px-4"><span>        processed++;</span></div><div class="px-4"><span>        if (processed % 1000 === 0) {</span></div><div class="px-4"><span>            console.log(`[MIGRATION] Processed ${processed}/${total}`);</span></div><div class="px-4"><span>        }</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    console.log(&#x27;[MIGRATION] Complete!&#x27;);</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<h2 id="registering-migrations"><a href="#registering-migrations" class="anchor-link">Registering Migrations</a></h2>
<p>Migrations are registered in <code>src/migrations/index.js</code>:</p>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>import migration001 from &#x27;./001_initial_schema.js&#x27;;</span></div><div class="px-4"><span>import migration002 from &#x27;./002_add_memories.js&#x27;;</span></div><div class="px-4"><span>import migration003 from &#x27;./003_add_chat_history.js&#x27;;</span></div><div class="px-4"><span>import migration004 from &#x27;./004_add_personality.js&#x27;;</span></div><div class="px-4"><span>import migration005 from &#x27;./005_add_relationships.js&#x27;;</span></div><div class="px-4"><span>import migration006 from &#x27;./006_add_server_memory.js&#x27;;</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>export const migrations = [</span></div><div class="px-4"><span>    migration001,</span></div><div class="px-4"><span>    migration002,</span></div><div class="px-4"><span>    migration003,</span></div><div class="px-4"><span>    migration004,</span></div><div class="px-4"><span>    migration005,</span></div><div class="px-4"><span>    migration006,  // Server-wide memory tables</span></div><div class="px-4"><span>];</span></div></code></pre></div>
<h2 id="recent-migrations"><a href="#recent-migrations" class="anchor-link">Recent Migrations</a></h2>
<h3 id="006_add_server_memory"><a href="#006_add_server_memory" class="anchor-link">006_add_server_memory</a></h3>
<p>Adds server-wide memory tables for ambient awareness:</p>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Tables created:</span></div><div class="px-4"><span>// - server_messages: Raw storage for ALL server messages</span></div><div class="px-4"><span>// - server_embeddings: Vector embeddings for important messages</span></div><div class="px-4"><span>// - channel_summaries: Periodic channel rollups (hourly/daily)</span></div><div class="px-4"><span>// - active_topics: Topic lifecycle tracking</span></div><div class="px-4"><span>// - embedding_queue: Background processing queue</span></div><div class="px-4"><span>// - channel_metadata: Channel statistics</span></div></code></pre></div>
<p>See <a href="/ai/server-memory">Server-Wide Memory</a> for full documentation.</p>
<h2 id="rolling-back"><a href="#rolling-back" class="anchor-link">Rolling Back</a></h2>
<p>SQLite doesn&#x27;t support easy rollbacks. For safety:</p>
<ol>
<li><strong>Always backup before migrations</strong></li>
</ol>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">bash</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>cp data/beboa.db data/beboa_backup_$(date +%Y%m%d_%H%M%S).db</span></div></code></pre></div>
<ol start="2">
<li><strong>Write rollback scripts</strong> (optional)</li>
</ol>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>const migrations = [</span></div><div class="px-4"><span>    {</span></div><div class="px-4"><span>        name: &#x27;004_add_timezone&#x27;,</span></div><div class="px-4"><span>        up: (db) =&gt; {</span></div><div class="px-4"><span>            db.exec(&#x27;ALTER TABLE users ADD COLUMN timezone TEXT&#x27;);</span></div><div class="px-4"><span>        },</span></div><div class="px-4"><span>        down: (db) =&gt; {</span></div><div class="px-4"><span>            // SQLite doesn&#x27;t support DROP COLUMN easily</span></div><div class="px-4"><span>            // Would need to recreate table</span></div><div class="px-4"><span>        }</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span>];</span></div></code></pre></div>
<ol start="3">
<li><strong>Test on copy first</strong></li>
</ol>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">bash</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>cp data/beboa.db data/test.db</span></div><div class="px-4"><span># Run migration on test.db first</span></div></code></pre></div>
<h2 id="complete-migration-example"><a href="#complete-migration-example" class="anchor-link">Complete Migration Example</a></h2>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// In src/services/database.js</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>function migration010AddGuildSettings(db) {</span></div><div class="px-4"><span>    // Create new table</span></div><div class="px-4"><span>    db.exec(`</span></div><div class="px-4"><span>        CREATE TABLE IF NOT EXISTS guild_settings (</span></div><div class="px-4"><span>            guild_id TEXT PRIMARY KEY,</span></div><div class="px-4"><span>            checkin_channel_id TEXT,</span></div><div class="px-4"><span>            notification_channel_id TEXT,</span></div><div class="px-4"><span>            admin_role_id TEXT,</span></div><div class="px-4"><span>            prefix TEXT DEFAULT &#x27;!&#x27;,</span></div><div class="px-4"><span>            language TEXT DEFAULT &#x27;en&#x27;,</span></div><div class="px-4"><span>            created_at TEXT DEFAULT CURRENT_TIMESTAMP,</span></div><div class="px-4"><span>            updated_at TEXT DEFAULT CURRENT_TIMESTAMP</span></div><div class="px-4"><span>        )</span></div><div class="px-4"><span>    `);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Add indexes</span></div><div class="px-4"><span>    db.exec(`</span></div><div class="px-4"><span>        CREATE INDEX IF NOT EXISTS idx_guild_settings_updated</span></div><div class="px-4"><span>        ON guild_settings(updated_at)</span></div><div class="px-4"><span>    `);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Migrate existing config if from single-guild setup</span></div><div class="px-4"><span>    const guildId = process.env.GUILD_ID;</span></div><div class="px-4"><span>    if (guildId) {</span></div><div class="px-4"><span>        db.prepare(`</span></div><div class="px-4"><span>            INSERT OR IGNORE INTO guild_settings</span></div><div class="px-4"><span>            (guild_id, checkin_channel_id, notification_channel_id, admin_role_id)</span></div><div class="px-4"><span>            VALUES (?, ?, ?, ?)</span></div><div class="px-4"><span>        `).run(</span></div><div class="px-4"><span>            guildId,</span></div><div class="px-4"><span>            process.env.CHECKIN_CHANNEL_ID,</span></div><div class="px-4"><span>            process.env.NOTIFICATION_CHANNEL_ID,</span></div><div class="px-4"><span>            process.env.ADMIN_ROLE_ID</span></div><div class="px-4"><span>        );</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    console.log(&#x27;[MIGRATION] Guild settings table created&#x27;);</span></div><div class="px-4"><span>}</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Register</span></div><div class="px-4"><span>const migrations = [</span></div><div class="px-4"><span>    // ... existing migrations</span></div><div class="px-4"><span>    { name: &#x27;010_add_guild_settings&#x27;, up: migration010AddGuildSettings },</span></div><div class="px-4"><span>];</span></div></code></pre></div>
<h2 id="troubleshooting"><a href="#troubleshooting" class="anchor-link">Troubleshooting</a></h2>
<h3 id="migration-wont-run"><a href="#migration-wont-run" class="anchor-link">Migration Won&#x27;t Run</a></h3>
<p>Check if already applied:</p>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">sql</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>SELECT * FROM migrations WHERE name = &#x27;migration_name&#x27;;</span></div></code></pre></div>
<h3 id="need-to-re-run-migration"><a href="#need-to-re-run-migration" class="anchor-link">Need to Re-run Migration</a></h3>
<p><strong>Dangerous - only for development:</strong></p>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">sql</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>DELETE FROM migrations WHERE name = &#x27;migration_name&#x27;;</span></div></code></pre></div>
<h3 id="database-locked"><a href="#database-locked" class="anchor-link">Database Locked</a></h3>
<p>Stop all bot instances before running migrations.</p>
<h3 id="check-migration-status"><a href="#check-migration-status" class="anchor-link">Check Migration Status</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>function getMigrationStatus() {</span></div><div class="px-4"><span>    return db.prepare(&#x27;SELECT * FROM migrations ORDER BY applied_at&#x27;).all();</span></div><div class="px-4"><span>}</span></div></code></pre></div></div><nav class="flex items-center justify-between mt-16 pt-8 border-t border-[var(--border)]"><a class="group flex items-center gap-2 px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)] hover:border-[var(--accent)] hover:shadow-soft transition-all" href="/dev/tools/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--accent)] transition-colors"><path d="m15 18-6-6 6-6"></path></svg><div class="text-left"><div class="text-xs text-[var(--text-muted)] mb-0.5">Previous</div><div class="text-sm font-medium text-[var(--text-primary)] group-hover:text-[var(--accent)] transition-colors">Custom Tools</div></div></a><a class="group flex items-center gap-2 px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)] hover:border-[var(--accent)] hover:shadow-soft transition-all" href="/dev/api/"><div class="text-right"><div class="text-xs text-[var(--text-muted)] mb-0.5">Next</div><div class="text-sm font-medium text-[var(--text-primary)] group-hover:text-[var(--accent)] transition-colors">API Reference</div></div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--accent)] transition-colors"><path d="m9 18 6-6-6-6"></path></svg></a></nav></article></div></main></div></div></div><script src="/_next/static/chunks/webpack-e5714bf66625afb9.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/443896d591e4f761-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/css/3cf59f0fd0496c15.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"4:I[2846,[],\"\"]\n7:I[4707,[],\"\"]\n9:I[6423,[],\"\"]\na:I[2060,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"185\",\"static/chunks/app/layout-4b75b78215e64ea2.js\"],\"ThemeProvider\"]\nb:I[4351,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"185\",\"static/chunks/app/layout-4b75b78215e64ea2.js\"],\"Header\"]\nc:I[9399,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"185\",\"static/chunks/app/layout-4b75b78215e64ea2.js\"],\"Sidebar\"]\ne:I[1060,[],\"\"]\n8:[\"slug\",\"dev/migrations\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L4\",null,{\"buildId\":\"FeUt14WxB_Uw-6zJdn3nr\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"dev\",\"migrations\",\"\"],\"initialTree\":[\"\",{\"children\":[[\"slug\",\"dev/migrations\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"dev\\\",\\\"migrations\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"dev/migrations\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L5\",\"$L6\",null],null],null]},[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$8\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3cf59f0fd0496c15.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_f367f3 __variable_a06722 font-sans\",\"children\":[\"$\",\"$La\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-[var(--bg-primary)] transition-colors duration-200\",\"children\":[[\"$\",\"$Lb\",null,{}],[\"$\",\"div\",null,{\"className\":\"flex\",\"children\":[[\"$\",\"$Lc\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 min-w-0 lg:pl-[var(--sidebar-width)]\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-[var(--content-max-width)] mx-auto px-6 py-8 lg:px-8 lg:py-12\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}]}]]}]]}]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]\n"])</script><script>self.__next_f.push([1,"10:I[6430,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"Breadcrumbs\"]\n11:I[9078,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"CopyPageButton\"]\n13:I[3308,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"PageNavigation\"]\n14:I[5321,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"TableOfContents\"]\n6:[[\"$\",\"article\",null,{\"className\":\"animate-in\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-start justify-between gap-4 mb-6\",\"children\":[[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}],[\"$\",\"h1\",null,{\"children\":\"Migrations\"}],\"$undefined\",[\"$\",\"div\",null,{\"className\":\"prose-custom\",\"children\":\"$L12\"}],[\"$\",\"$L13\",null,{}]]}],[\"$\",\"$L14\",null,{}]]\nd:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Migrations - Beboa Docs\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n5:null\n"])</script><script>self.__next_f.push([1,"15:I[5045,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"CodeBlock\"]\n16:T54d,// In src/services/database.js\n\nfunction migration010AddGuildSettings(db) {\n    // Create new table\n    db.exec(`\n        CREATE TABLE IF NOT EXISTS guild_settings (\n            guild_id TEXT PRIMARY KEY,\n            checkin_channel_id TEXT,\n            notification_channel_id TEXT,\n            admin_role_id TEXT,\n            prefix TEXT DEFAULT '!',\n            language TEXT DEFAULT 'en',\n            created_at TEXT DEFAULT CURRENT_TIMESTAMP,\n            updated_at TEXT DEFAULT CURRENT_TIMESTAMP\n        )\n    `);\n\n    // Add indexes\n    db.exec(`\n        CREATE INDEX IF NOT EXISTS idx_guild_settings_updated\n        ON guild_settings(updated_at)\n    `);\n\n    // Migrate existing config if from single-guild setup\n    const guildId = process.env.GUILD_ID;\n    if (guildId) {\n        db.prepare(`\n            INSERT OR IGNORE INTO guild_settings\n            (guild_id, checkin_channel_id, notification_channel_id, admin_role_id)\n            VALUES (?, ?, ?, ?)\n        `).run(\n            guildId,\n            process.env.CHECKIN_CHANNEL_ID,\n            process.env.NOTIFICATION_CHANNEL_ID,\n            process.env.ADMIN_ROLE_ID\n        );\n    }\n\n    console.log('[MIGRATION] Guild settings table created');\n}\n\n// Register\nconst migrations = [\n    // ... existing migrations\n    { name: '010_add_guild_settings', up: migration010AddGuildSettings },\n];"])</script><script>self.__next_f.push([1,"12:[[\"$\",\"h1\",null,{\"id\":\"database-migrations\",\"children\":\"Database Migrations\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Guide to safely updating the database schema.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"migration-system\",\"children\":[\"$\",\"a\",null,{\"href\":\"#migration-system\",\"className\":\"anchor-link\",\"children\":\"Migration System\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Beboa uses a simple migration system to track schema changes:\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"data/\\n‚îú‚îÄ‚îÄ beboa.db           # Main database\\n‚îî‚îÄ‚îÄ migrations/        # Migration scripts (optional)\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"migration-table\",\"children\":[\"$\",\"a\",null,{\"href\":\"#migration-table\",\"className\":\"anchor-link\",\"children\":\"Migration Table\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"sql\",\"children\":\"CREATE TABLE IF NOT EXISTS migrations (\\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\\n    name TEXT UNIQUE NOT NULL,\\n    applied_at TEXT DEFAULT CURRENT_TIMESTAMP\\n);\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"running-migrations\",\"children\":[\"$\",\"a\",null,{\"href\":\"#running-migrations\",\"className\":\"anchor-link\",\"children\":\"Running Migrations\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Migrations run automatically on startup in \",[\"$\",\"code\",null,{\"children\":\"src/services/database.js\"}],\":\"]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"function runMigrations() {\\n    const migrations = [\\n        { name: '001_initial_schema', up: migration001 },\\n        { name: '002_add_memories', up: migration002 },\\n        { name: '003_add_chat_history', up: migration003 },\\n        // Add new migrations here\\n    ];\\n\\n    for (const migration of migrations) {\\n        const applied = db.prepare(\\n            'SELECT 1 FROM migrations WHERE name = ?'\\n        ).get(migration.name);\\n\\n        if (!applied) {\\n            console.log(`[DB] Running migration: ${migration.name}`);\\n            migration.up(db);\\n            db.prepare('INSERT INTO migrations (name) VALUES (?)').run(migration.name);\\n        }\\n    }\\n}\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"writing-migrations\",\"children\":[\"$\",\"a\",null,{\"href\":\"#writing-migrations\",\"className\":\"anchor-link\",\"children\":\"Writing Migrations\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"adding-a-column\",\"children\":[\"$\",\"a\",null,{\"href\":\"#adding-a-column\",\"className\":\"anchor-link\",\"children\":\"Adding a Column\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"function migration004AddUserTimezone(db) {\\n    // Check if column exists\\n    const columns = db.pragma('table_info(users)');\\n    const hasTimezone = columns.some(c =\u003e c.name === 'timezone');\\n\\n    if (!hasTimezone) {\\n        db.exec(`\\n            ALTER TABLE users\\n            ADD COLUMN timezone TEXT DEFAULT 'UTC'\\n        `);\\n    }\\n}\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"adding-a-table\",\"children\":[\"$\",\"a\",null,{\"href\":\"#adding-a-table\",\"className\":\"anchor-link\",\"children\":\"Adding a Table\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"function migration005AddAchievements(db) {\\n    db.exec(`\\n        CREATE TABLE IF NOT EXISTS achievements (\\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\\n            user_id TEXT NOT NULL,\\n            achievement_id TEXT NOT NULL,\\n            unlocked_at TEXT DEFAULT CURRENT_TIMESTAMP,\\n            FOREIGN KEY (user_id) REFERENCES users(user_id),\\n            UNIQUE(user_id, achievement_id)\\n        );\\n\\n        CREATE INDEX IF NOT EXISTS idx_achievements_user\\n        ON achievements(user_id);\\n    `);\\n}\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"adding-an-index\",\"children\":[\"$\",\"a\",null,{\"href\":\"#adding-an-index\",\"className\":\"anchor-link\",\"children\":\"Adding an Index\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"function migration006AddBebitIndex(db) {\\n    db.exec(`\\n        CREATE INDEX IF NOT EXISTS idx_users_bebits_desc\\n        ON users(bebits DESC)\\n    `);\\n}\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"modifying-data\",\"children\":[\"$\",\"a\",null,{\"href\":\"#modifying-data\",\"className\":\"anchor-link\",\"children\":\"Modifying Data\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"function migration007NormalizeUsernames(db) {\\n    // Get all users\\n    const users = db.prepare('SELECT user_id, username FROM users').all();\\n\\n    // Update each user\\n    const update = db.prepare('UPDATE users SET username = ? WHERE user_id = ?');\\n\\n    for (const user of users) {\\n        if (user.username) {\\n            const normalized = user.username.toLowerCase().trim();\\n            update.run(normalized, user.user_id);\\n        }\\n    }\\n}\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"migration-best-practices\",\"children\":[\"$\",\"a\",null,{\"href\":\"#migration-best-practices\",\"className\":\"anchor-link\",\"children\":\"Migration Best Practices\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"always-use-if-not-exists\",\"children\":[\"$\",\"a\",null,{\"href\":\"#always-use-if-not-exists\",\"className\":\"anchor-link\",\"children\":\"Always Use IF NOT EXISTS\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Good\\ndb.exec('CREATE TABLE IF NOT EXISTS new_table (...)');\\ndb.exec('CREATE INDEX IF NOT EXISTS idx_name ON table(column)');\\n\\n// Bad - will fail if run twice\\ndb.exec('CREATE TABLE new_table (...)');\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"check-before-altering\",\"children\":[\"$\",\"a\",null,{\"href\":\"#check-before-altering\",\"className\":\"anchor-link\",\"children\":\"Check Before Altering\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"function safeAddColumn(db, table, column, definition) {\\n    const columns = db.pragma(`table_info(${table})`);\\n    const exists = columns.some(c =\u003e c.name === column);\\n\\n    if (!exists) {\\n        db.exec(`ALTER TABLE ${table} ADD COLUMN ${column} ${definition}`);\\n        return true;\\n    }\\n    return false;\\n}\\n\\n// Usage\\nsafeAddColumn(db, 'users', 'new_column', 'TEXT DEFAULT NULL');\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"use-transactions-for-data-migrations\",\"children\":[\"$\",\"a\",null,{\"href\":\"#use-transactions-for-data-migrations\",\"className\":\"anchor-link\",\"children\":\"Use Transactions for Data Migrations\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"function migration008ComplexDataMigration(db) {\\n    const transaction = db.transaction(() =\u003e {\\n        // Multiple operations\\n        db.exec('UPDATE users SET status = \\\"active\\\" WHERE status IS NULL');\\n        db.exec('DELETE FROM old_table WHERE migrated = 1');\\n        db.exec('INSERT INTO new_table SELECT * FROM temp_table');\\n    });\\n\\n    transaction();\\n}\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"log-migration-progress\",\"children\":[\"$\",\"a\",null,{\"href\":\"#log-migration-progress\",\"className\":\"anchor-link\",\"children\":\"Log Migration Progress\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"function migration009LargeMigration(db) {\\n    console.log('[MIGRATION] Starting large migration...');\\n\\n    const total = db.prepare('SELECT COUNT(*) as count FROM large_table').get().count;\\n    let processed = 0;\\n\\n    const rows = db.prepare('SELECT * FROM large_table').all();\\n\\n    for (const row of rows) {\\n        // Process row\\n        processed++;\\n        if (processed % 1000 === 0) {\\n            console.log(`[MIGRATION] Processed ${processed}/${total}`);\\n        }\\n    }\\n\\n    console.log('[MIGRATION] Complete!');\\n}\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"registering-migrations\",\"children\":[\"$\",\"a\",null,{\"href\":\"#registering-migrations\",\"className\":\"anchor-link\",\"children\":\"Registering Migrations\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Migrations are registered in \",[\"$\",\"code\",null,{\"children\":\"src/migrations/index.js\"}],\":\"]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"import migration001 from './001_initial_schema.js';\\nimport migration002 from './002_add_memories.js';\\nimport migration003 from './003_add_chat_history.js';\\nimport migration004 from './004_add_personality.js';\\nimport migration005 from './005_add_relationships.js';\\nimport migration006 from './006_add_server_memory.js';\\n\\nexport const migrations = [\\n    migration001,\\n    migration002,\\n    migration003,\\n    migration004,\\n    migration005,\\n    migration006,  // Server-wide memory tables\\n];\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"recent-migrations\",\"children\":[\"$\",\"a\",null,{\"href\":\"#recent-migrations\",\"className\":\"anchor-link\",\"children\":\"Recent Migrations\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"006_add_server_memory\",\"children\":[\"$\",\"a\",null,{\"href\":\"#006_add_server_memory\",\"className\":\"anchor-link\",\"children\":\"006_add_server_memory\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Adds server-wide memory tables for ambient awareness:\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Tables created:\\n// - server_messages: Raw storage for ALL server messages\\n// - server_embeddings: Vector embeddings for important messages\\n// - channel_summaries: Periodic channel rollups (hourly/daily)\\n// - active_topics: Topic lifecycle tracking\\n// - embedding_queue: Background processing queue\\n// - channel_metadata: Channel statistics\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"See \",[\"$\",\"a\",null,{\"href\":\"/ai/server-memory\",\"children\":\"Server-Wide Memory\"}],\" for full documentation.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"rolling-back\",\"children\":[\"$\",\"a\",null,{\"href\":\"#rolling-back\",\"className\":\"anchor-link\",\"children\":\"Rolling Back\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"SQLite doesn't support easy rollbacks. For safety:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Always backup before migrations\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"bash\",\"children\":\"cp data/beboa.db data/beboa_backup_$(date +%Y%m%d_%H%M%S).db\"}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"2\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Write rollback scripts\"}],\" (optional)\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"const migrations = [\\n    {\\n        name: '004_add_timezone',\\n        up: (db) =\u003e {\\n            db.exec('ALTER TABLE users ADD COLUMN timezone TEXT');\\n        },\\n        down: (db) =\u003e {\\n            // SQLite doesn't support DROP COLUMN easily\\n            // Would need to recreate table\\n        }\\n    }\\n];\"}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"3\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Test on copy first\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"bash\",\"children\":\"cp data/beboa.db data/test.db\\n# Run migration on test.db first\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"complete-migration-example\",\"children\":[\"$\",\"a\",null,{\"href\":\"#complete-migration-example\",\"className\":\"anchor-link\",\"children\":\"Complete Migration Example\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"$16\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"troubleshooting\",\"children\":[\"$\",\"a\",null,{\"href\":\"#troubleshooting\",\"className\":\"anchor-link\",\"children\":\"Troubleshooting\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"migration-wont-run\",\"children\":[\"$\",\"a\",null,{\"href\":\"#migration-wont-run\",\"className\":\"anchor-link\",\"children\":\"Migration Won't Run\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Check if already applied:\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"sql\",\"children\":\"SELECT * FROM migrations WHERE name = 'migration_name';\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"need-to-re-run-migration\",\"children\":[\"$\",\"a\",null,{\"href\":\"#need-to-re-run-migration\",\"className\":\"anchor-link\",\"children\":\"Need to Re-run Migration\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Dangerous - only for development:\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"sql\",\"children\":\"DELETE FROM migrations WHERE name = 'migration_name';\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"database-locked\",\"children\":[\"$\",\"a\",null,{\"href\":\"#database-locked\",\"className\":\"anchor-link\",\"children\":\"Database Locked\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Stop all bot instances before running migrations.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"check-migration-status\",\"children\":[\"$\",\"a\",null,{\"href\":\"#check-migration-status\",\"className\":\"anchor-link\",\"children\":\"Check Migration Status\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"function getMigrationStatus() {\\n    return db.prepare('SELECT * FROM migrations ORDER BY applied_at').all();\\n}\"}]]\n"])</script></body></html>