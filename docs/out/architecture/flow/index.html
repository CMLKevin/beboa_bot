<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/443896d591e4f761-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/3cf59f0fd0496c15.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-e5714bf66625afb9.js"/><script src="/_next/static/chunks/fd9d1056-e1b8fc02af805f43.js" async=""></script><script src="/_next/static/chunks/117-bf803eaaef7a29e0.js" async=""></script><script src="/_next/static/chunks/main-app-b6379442ececfbb8.js" async=""></script><script src="/_next/static/chunks/972-68a674eeca97bbbb.js" async=""></script><script src="/_next/static/chunks/646-1e67c3e800eb58dd.js" async=""></script><script src="/_next/static/chunks/app/layout-4b75b78215e64ea2.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js" async=""></script><title>Message Flow - Beboa Docs</title><meta name="description" content="How messages flow through Beboa&#x27;s architecture."/><link rel="icon" href="/favicon.ico"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_f367f3 __variable_a06722 font-sans"><div style="visibility:hidden"><div class="min-h-screen bg-[var(--bg-primary)] transition-colors duration-200"><header class="sticky top-0 z-40 w-full h-[var(--header-height)] bg-[var(--bg-secondary)] border-b border-[var(--border)]"><div class="flex items-center justify-between h-full px-4 lg:px-6"><div class="flex items-center gap-6"><button class="lg:hidden p-2 -ml-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu w-5 h-5"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><a class="flex items-center gap-2 text-lg font-semibold text-[var(--text-primary)] hover:text-[var(--accent)] transition-colors" href="/"><span class="text-xl">ğŸ</span><span class="hidden sm:inline">Beboa</span><span class="hidden sm:inline text-xs font-normal text-[var(--text-muted)] ml-1">Docs</span></a><nav class="hidden lg:flex items-center gap-1"><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/">User Guide</a><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/">AI Systems</a><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/">Jarvis Mode</a><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--accent)] bg-[var(--accent-light)]" href="/architecture/structure/">Reference</a></nav></div><div class="flex items-center gap-3"><div class="hidden sm:block"><button class="flex items-center gap-2 px-3 py-2 text-sm text-[var(--text-muted)] bg-[var(--bg-tertiary)] hover:bg-[var(--border)] rounded-lg border border-[var(--border)] transition-colors w-full max-w-[240px]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search w-4 h-4"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><span class="flex-1 text-left">Search docs...</span><kbd class="hidden sm:inline-flex items-center gap-0.5 px-1.5 py-0.5 text-xs font-medium text-[var(--text-muted)] bg-[var(--bg-secondary)] rounded border border-[var(--border)]"><span class="text-xs">âŒ˜</span>K</kbd></button></div><button class="sm:hidden p-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Search"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button><a href="https://github.com/CMLKevin/beboa_evo" target="_blank" rel="noopener noreferrer" class="hidden sm:flex p-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github w-5 h-5"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></a><button class="p-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Switch to dark mode"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon w-5 h-5"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg></button></div></div></header><aside class="fixed inset-y-0 left-0 z-50 w-72 bg-[var(--bg-secondary)] border-r border-[var(--border)] transform transition-transform duration-300 ease-in-out lg:hidden -translate-x-full"><div class="flex items-center justify-between h-[var(--header-height)] px-4 border-b border-[var(--border)]"><a class="flex items-center gap-2 text-lg font-semibold text-[var(--text-primary)]" href="/"><span class="text-xl">ğŸ</span><span>Beboa</span></a><button class="p-2 -mr-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Close menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x w-5 h-5"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button></div><div class="p-4 border-b border-[var(--border)]"><div class="flex flex-wrap gap-2"><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-tertiary)]" href="/">User Guide</a><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-tertiary)]" href="/ai/">AI Systems</a><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-tertiary)]" href="/jarvis/">Jarvis Mode</a><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--accent)] bg-[var(--accent-light)]" href="/architecture/structure/">Reference</a></div></div><nav class="overflow-y-auto h-[calc(100%-128px)] py-4 px-4"><ul class="space-y-1"><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Getting Started</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/">Home</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/getting-started/installation/">Installation</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/getting-started/configuration/">Configuration</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/getting-started/quickstart/">Quick Start</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Features</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/">Overview</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/checkins/">Daily Check-ins</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/bebits/">Bebits &amp; Rewards</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/chat/">AI Chat</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">AI Systems</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/">Overview</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/personality/">Dynamic Personality</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/moods/">Mood System</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/relationships/">Relationships</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/memory/">Semantic Memory</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/llm-evaluator/">LLM Evaluator</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/tools/">Tool Calls</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Jarvis Mode 2.0</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/">Overview</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/commands/">Commands Reference</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/parsing/">Intent Parsing</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/fun/">Fun Commands</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Commands</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/commands/user/">User Commands</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/commands/admin/">Admin Commands</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Architecture</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/structure/">Project Structure</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/database/">Database Schema</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/services/">Services</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--accent)] bg-[var(--accent-light)] font-medium" href="/architecture/flow/">Message Flow</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Developer Guide</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/commands/">Extending Commands</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/tools/">Custom Tools</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/migrations/">Database Migrations</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/api/">API Reference</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Deployment</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/railway/">Railway</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/vps/">VPS Setup</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/docker/">Docker</a></li></ul></li></ul></nav></aside><div class="flex"><aside class="hidden lg:block fixed top-[var(--header-height)] left-0 bottom-0 w-[var(--sidebar-width)] border-r border-[var(--border)] bg-[var(--bg-secondary)] overflow-y-auto"><nav class="py-6 px-4"><ul class="space-y-6"><li><div class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Architecture</div><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/structure/">Project Structure</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/database/">Database Schema</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/services/">Services</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/flow/">Message Flow</a></li></ul></li><li><div class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Developer Guide</div><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/commands/">Extending Commands</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/tools/">Custom Tools</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/migrations/">Database Migrations</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/api/">API Reference</a></li></ul></li><li><div class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Deployment</div><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/railway/">Railway</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/vps/">VPS Setup</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/docker/">Docker</a></li></ul></li></ul></nav></aside><main class="flex-1 min-w-0 lg:pl-[var(--sidebar-width)]"><div class="max-w-[var(--content-max-width)] mx-auto px-6 py-8 lg:px-8 lg:py-12"><article class="animate-in"><div class="flex items-start justify-between gap-4 mb-6"><nav aria-label="Breadcrumb" class="flex items-center gap-1.5 text-sm mb-4"><div class="flex items-center gap-1.5"><a class="text-[var(--text-muted)] hover:text-[var(--text-primary)] transition-colors" href="/architecture/structure/">Architecture</a></div></nav><button class="flex items-center gap-1.5 px-3 py-1.5 text-sm text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)] rounded-md transition-colors border border-transparent hover:border-[var(--border)]" title="Copy page content"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-4 h-4"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy page</span></button></div><h1>Message Flow</h1><p class="text-lg text-[var(--text-secondary)] mb-8 -mt-2">How messages flow through Beboa&#x27;s architecture.</p><div class="prose-custom"><h1 id="message-flow">Message Flow</h1>
<p>How messages flow through Beboa&#x27;s architecture.</p>
<h2 id="high-level-flow"><a href="#high-level-flow" class="anchor-link">High-Level Flow</a></h2>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>Discord Gateway</span></div><div class="px-4"><span>      â”‚</span></div><div class="px-4"><span>      â–¼</span></div><div class="px-4"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="px-4"><span>â”‚  Discord.js     â”‚</span></div><div class="px-4"><span>â”‚  Client         â”‚</span></div><div class="px-4"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="px-4"><span>â”‚ Event Router    â”‚â”€â”€â”€â”€â–¶â”‚ Slash Commands  â”‚</span></div><div class="px-4"><span>â”‚                 â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="px-4"><span>â”‚ messageCreate   â”‚</span></div><div class="px-4"><span>â”‚ interactionCreateâ”‚</span></div><div class="px-4"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="px-4"><span>â”‚ Message Handler â”‚</span></div><div class="px-4"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”</span></div><div class="px-4"><span>    â”‚         â”‚</span></div><div class="px-4"><span>    â–¼         â–¼</span></div><div class="px-4"><span>@Mention   Jarvis Mode</span></div><div class="px-4"><span>    â”‚         â”‚</span></div><div class="px-4"><span>    â–¼         â–¼</span></div><div class="px-4"><span>Chat AI    Admin Command</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h2 id="slash-command-flow"><a href="#slash-command-flow" class="anchor-link">Slash Command Flow</a></h2>
<p>When a user runs <code>/checkin</code>:</p>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>1. User types /checkin</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>2. Discord sends interactionCreate event</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>3. interactionCreate.js routes to command</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>4. commands/checkin.js executes</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>5. database.js performs check-in logic</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>6. Response sent via interaction.reply()</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h3 id="detailed-sequence"><a href="#detailed-sequence" class="anchor-link">Detailed Sequence</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// 1. Event received</span></div><div class="px-4"><span>client.on(&#x27;interactionCreate&#x27;, async (interaction) =&gt; {</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 2. Check if it&#x27;s a command</span></div><div class="px-4"><span>    if (!interaction.isChatInputCommand()) return;</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 3. Get command handler</span></div><div class="px-4"><span>    const command = commands.get(interaction.commandName);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 4. Execute command</span></div><div class="px-4"><span>    try {</span></div><div class="px-4"><span>        await command.execute(interaction);</span></div><div class="px-4"><span>    } catch (error) {</span></div><div class="px-4"><span>        await interaction.reply({ content: &#x27;Error!&#x27;, ephemeral: true });</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span>});</span></div></code></pre></div>
<h2 id="chat-message-flow"><a href="#chat-message-flow" class="anchor-link">Chat Message Flow</a></h2>
<p>When a user @mentions Beboa:</p>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>1. User sends &quot;@Beboa hello!&quot;</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>2. messageCreate event fires</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>3. Check: Is Beboa mentioned?</span></div><div class="px-4"><span>         â”‚ Yes</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>4. Check: Is user on cooldown?</span></div><div class="px-4"><span>         â”‚ No</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>5. Build context</span></div><div class="px-4"><span>   â”œâ”€ Get channel messages</span></div><div class="px-4"><span>   â”œâ”€ Get conversation history</span></div><div class="px-4"><span>   â”œâ”€ Retrieve relevant memories</span></div><div class="px-4"><span>   â”œâ”€ Load personality state</span></div><div class="px-4"><span>   â””â”€ Get current mood</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>6. Construct messages array</span></div><div class="px-4"><span>   â”œâ”€ System prompt (personality + context)</span></div><div class="px-4"><span>   â”œâ”€ Recent history</span></div><div class="px-4"><span>   â””â”€ User&#x27;s message</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>7. Call OpenRouter API</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>8. Check for tool calls</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”</span></div><div class="px-4"><span>    â”‚         â”‚</span></div><div class="px-4"><span>  None     Tool call</span></div><div class="px-4"><span>    â”‚         â”‚</span></div><div class="px-4"><span>    â”‚         â–¼</span></div><div class="px-4"><span>    â”‚    Execute tool</span></div><div class="px-4"><span>    â”‚         â”‚</span></div><div class="px-4"><span>    â”‚         â–¼</span></div><div class="px-4"><span>    â”‚    Continue generation</span></div><div class="px-4"><span>    â”‚         â”‚</span></div><div class="px-4"><span>    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>9. Send response</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>10. Post-processing (LLM-powered)</span></div><div class="px-4"><span>    â”œâ”€ Update conversation history</span></div><div class="px-4"><span>    â”œâ”€ Extract memories (if enabled)</span></div><div class="px-4"><span>    â”œâ”€ LLM: Evaluate mood (evaluateMood)</span></div><div class="px-4"><span>    â”œâ”€ LLM: Evaluate relationship (evaluateRelationship)</span></div><div class="px-4"><span>    â””â”€ Apply mood/relationship changes</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h3 id="code-flow"><a href="#code-flow" class="anchor-link">Code Flow</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// messageCreate.js</span></div><div class="px-4"><span>export async function execute(message) {</span></div><div class="px-4"><span>    // Skip bots</span></div><div class="px-4"><span>    if (message.author.bot) return;</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Check for mention</span></div><div class="px-4"><span>    if (message.mentions.has(client.user)) {</span></div><div class="px-4"><span>        await handleMention(message);</span></div><div class="px-4"><span>        return;</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Check for Jarvis Mode</span></div><div class="px-4"><span>    if (await isJarvisUser(message.author.id)) {</span></div><div class="px-4"><span>        const result = await handleJarvisCommand(message);</span></div><div class="px-4"><span>        if (result.handled) return;</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span>}</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>async function handleMention(message) {</span></div><div class="px-4"><span>    const userId = message.author.id;</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Cooldown check</span></div><div class="px-4"><span>    if (await isOnCooldown(userId)) {</span></div><div class="px-4"><span>        return message.reply(&quot;Please wait a moment!&quot;);</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Set cooldown</span></div><div class="px-4"><span>    setCooldown(userId);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Build context</span></div><div class="px-4"><span>    const context = await buildChatContext(userId, message.channel);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Generate response</span></div><div class="px-4"><span>    const response = await chat.handleChat(message, context);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Handle response (may include tool results)</span></div><div class="px-4"><span>    await sendResponse(message, response);</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<h2 id="jarvis-mode-flow-llm-first"><a href="#jarvis-mode-flow-llm-first" class="anchor-link">Jarvis Mode Flow (LLM-First)</a></h2>
<p>When a Jarvis user sends a command:</p>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>1. User sends &quot;give @user 100 bebits&quot;</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>2. messageCreate event fires</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>3. Check: Is user a Jarvis user?</span></div><div class="px-4"><span>         â”‚ Yes</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>4. Stage 1: Check pending confirmations</span></div><div class="px-4"><span>         â”‚ None pending</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>5. Stage 2: LLM Intent Parser (PRIMARY)</span></div><div class="px-4"><span>   â””â”€ parseJarvisIntent(&quot;give @user 100 bebits&quot;)</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>   LLM Response:</span></div><div class="px-4"><span>   â”œâ”€ command: &quot;give_bebits&quot;</span></div><div class="px-4"><span>   â”œâ”€ confidence: 0.92</span></div><div class="px-4"><span>   â”œâ”€ params: { targetUserId, amount: 100 }</span></div><div class="px-4"><span>   â””â”€ requiresConfirmation: false</span></div><div class="px-4"><span>         â”‚ confidence &gt; 0.6</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>6. Execute command</span></div><div class="px-4"><span>   â””â”€ database.addBebits(userId, 100)</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>7. Send response</span></div><div class="px-4"><span>   â””â”€ &quot;Gave 100 bebits to @user!&quot;</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>8. Update context</span></div><div class="px-4"><span>   â”œâ”€ lastMentionedUser = @user</span></div><div class="px-4"><span>   â””â”€ lastCommand = give_bebits</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h3 id="fallback-path-llm-unavailable"><a href="#fallback-path-llm-unavailable" class="anchor-link">Fallback Path (LLM unavailable)</a></h3>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>5. Stage 2: LLM Intent Parser</span></div><div class="px-4"><span>         â”‚ Returns null (rate limited)</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>6. Stage 3: Pattern Matching (FALLBACK)</span></div><div class="px-4"><span>   â””â”€ Regex: /give\s+(?:&lt;@!?)?(\d+)&gt;?\s+(\d+)/</span></div><div class="px-4"><span>         â”‚ Match found</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>7. Execute command</span></div><div class="px-4"><span>   â””â”€ Continue as normal</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h3 id="confirmation-flow"><a href="#confirmation-flow" class="anchor-link">Confirmation Flow</a></h3>
<p>For commands requiring confirmation:</p>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>1. &quot;give everyone 1000 bebits&quot;</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>2. Parse and validate</span></div><div class="px-4"><span>   â””â”€ requiresConfirmation = true</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>3. Send confirmation request</span></div><div class="px-4"><span>   â””â”€ &quot;This will give 1000 to 50 users. Confirm?&quot;</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>4. Store pending confirmation</span></div><div class="px-4"><span>   â””â”€ pendingConfirmations[userId] = { command, params }</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>5. Wait for next message</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>6. User sends &quot;confirm&quot;</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>7. Check pending confirmations</span></div><div class="px-4"><span>   â””â”€ Found pending for this user</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>8. Execute original command</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>9. Clear pending confirmation</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h2 id="tool-call-flow"><a href="#tool-call-flow" class="anchor-link">Tool Call Flow</a></h2>
<p>When the AI decides to use a tool:</p>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>1. AI response includes tool_call</span></div><div class="px-4"><span>   â””â”€ { name: &quot;generate_image&quot;, arguments: { prompt: &quot;cute snake&quot; } }</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>2. Parse tool call</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>3. Execute tool</span></div><div class="px-4"><span>   â””â”€ tools.generateImage(&quot;cute snake&quot;)</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>4. Get result</span></div><div class="px-4"><span>   â””â”€ { success: true, url: &quot;https://...&quot; }</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>5. Send image to channel</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>6. (Optional) Continue conversation</span></div><div class="px-4"><span>   â””â”€ AI may add text response after tool</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h2 id="memory-extraction-flow"><a href="#memory-extraction-flow" class="anchor-link">Memory Extraction Flow</a></h2>
<p>Post-conversation memory processing:</p>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>1. Conversation complete</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>2. Check: MEMORY_AUTO_EXTRACT enabled?</span></div><div class="px-4"><span>         â”‚ Yes</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>3. Send conversation to extraction model</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>4. AI extracts facts</span></div><div class="px-4"><span>   â””â”€ [{ content: &quot;User likes cats&quot;, type: &quot;preference&quot;, importance: 0.7 }]</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>5. For each extracted memory:</span></div><div class="px-4"><span>   â”œâ”€ Generate embedding</span></div><div class="px-4"><span>   â””â”€ Store in database</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>6. Log extraction results</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h2 id="error-handling-flow"><a href="#error-handling-flow" class="anchor-link">Error Handling Flow</a></h2>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>1. Error occurs at any stage</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>2. Catch error in handler</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>3. Log error details</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>4. Determine error type</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="px-4"><span>    â”‚         â”‚          â”‚</span></div><div class="px-4"><span>  API Error  DB Error  Other</span></div><div class="px-4"><span>    â”‚         â”‚          â”‚</span></div><div class="px-4"><span>    â–¼         â–¼          â–¼</span></div><div class="px-4"><span>&quot;AI busy&quot;  &quot;Oops!&quot;   Generic</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>5. Send user-friendly error message</span></div><div class="px-4"><span>         â”‚</span></div><div class="px-4"><span>         â–¼</span></div><div class="px-4"><span>6. (Optional) Notify admin for critical errors</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h2 id="performance-considerations"><a href="#performance-considerations" class="anchor-link">Performance Considerations</a></h2>
<table><thead><tr><th>Stage</th><th>Typical Latency</th><th>Notes</th></tr></thead><tbody><tr><td>Discord event</td><td>&lt;50ms</td><td>Gateway to handler</td></tr><tr><td>Database query</td><td>&lt;10ms</td><td>SQLite is fast</td></tr><tr><td>Context building</td><td>50-100ms</td><td>Multiple queries</td></tr><tr><td>OpenRouter API</td><td>500-3000ms</td><td>Main bottleneck</td></tr><tr><td>Memory search</td><td>100-200ms</td><td>Embedding + similarity</td></tr><tr><td>Tool execution</td><td>500-5000ms</td><td>Varies by tool</td></tr></tbody></table>
<h3 id="optimization-tips"><a href="#optimization-tips" class="anchor-link">Optimization Tips</a></h3>
<ol>
<li><strong>Parallel queries</strong> - Build context concurrently</li>
<li><strong>Cache personality</strong> - Doesn&#x27;t change often</li>
<li><strong>Limit history</strong> - Don&#x27;t send full history every time</li>
<li><strong>Batch embeddings</strong> - For multi-memory extraction</li>
</ol></div><nav class="flex items-center justify-between mt-16 pt-8 border-t border-[var(--border)]"><a class="group flex items-center gap-2 px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)] hover:border-[var(--accent)] hover:shadow-soft transition-all" href="/architecture/services/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--accent)] transition-colors"><path d="m15 18-6-6 6-6"></path></svg><div class="text-left"><div class="text-xs text-[var(--text-muted)] mb-0.5">Previous</div><div class="text-sm font-medium text-[var(--text-primary)] group-hover:text-[var(--accent)] transition-colors">Services</div></div></a><a class="group flex items-center gap-2 px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)] hover:border-[var(--accent)] hover:shadow-soft transition-all" href="/dev/commands/"><div class="text-right"><div class="text-xs text-[var(--text-muted)] mb-0.5">Next</div><div class="text-sm font-medium text-[var(--text-primary)] group-hover:text-[var(--accent)] transition-colors">Extending Commands</div></div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--accent)] transition-colors"><path d="m9 18 6-6-6-6"></path></svg></a></nav></article></div></main></div></div></div><script src="/_next/static/chunks/webpack-e5714bf66625afb9.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/443896d591e4f761-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/css/3cf59f0fd0496c15.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"4:I[2846,[],\"\"]\n7:I[4707,[],\"\"]\n9:I[6423,[],\"\"]\na:I[2060,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"185\",\"static/chunks/app/layout-4b75b78215e64ea2.js\"],\"ThemeProvider\"]\nb:I[4351,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"185\",\"static/chunks/app/layout-4b75b78215e64ea2.js\"],\"Header\"]\nc:I[9399,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"185\",\"static/chunks/app/layout-4b75b78215e64ea2.js\"],\"Sidebar\"]\ne:I[1060,[],\"\"]\n8:[\"slug\",\"architecture/flow\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L4\",null,{\"buildId\":\"FeUt14WxB_Uw-6zJdn3nr\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"architecture\",\"flow\",\"\"],\"initialTree\":[\"\",{\"children\":[[\"slug\",\"architecture/flow\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"architecture\\\",\\\"flow\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"architecture/flow\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L5\",\"$L6\",null],null],null]},[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$8\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3cf59f0fd0496c15.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_f367f3 __variable_a06722 font-sans\",\"children\":[\"$\",\"$La\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-[var(--bg-primary)] transition-colors duration-200\",\"children\":[[\"$\",\"$Lb\",null,{}],[\"$\",\"div\",null,{\"className\":\"flex\",\"children\":[[\"$\",\"$Lc\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 min-w-0 lg:pl-[var(--sidebar-width)]\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-[var(--content-max-width)] mx-auto px-6 py-8 lg:px-8 lg:py-12\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}]}]]}]]}]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]\n"])</script><script>self.__next_f.push([1,"10:I[6430,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"Breadcrumbs\"]\n11:I[9078,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"CopyPageButton\"]\n13:I[3308,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"PageNavigation\"]\n14:I[5321,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"TableOfContents\"]\n6:[[\"$\",\"article\",null,{\"className\":\"animate-in\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-start justify-between gap-4 mb-6\",\"children\":[[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}],[\"$\",\"h1\",null,{\"children\":\"Message Flow\"}],[\"$\",\"p\",null,{\"className\":\"text-lg text-[var(--text-secondary)] mb-8 -mt-2\",\"children\":\"How messages flow through Beboa's architecture.\"}],[\"$\",\"div\",null,{\"className\":\"prose-custom\",\"children\":\"$L12\"}],[\"$\",\"$L13\",null,{}]]}],[\"$\",\"$L14\",null,{}]]\nd:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Message Flow - Beboa Docs\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"How messages flow through Beboa's architecture.\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}],[\"$\",\"meta\",\"5\",{\"name\":\"next-size-adjust\"}]]\n5:null\n"])</script><script>self.__next_f.push([1,"15:I[5045,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"CodeBlock\"]\n16:T4fe,1. User sends \"@Beboa hello!\"\n         â”‚\n         â–¼\n2. messageCreate event fires\n         â”‚\n         â–¼\n3. Check: Is Beboa mentioned?\n         â”‚ Yes\n         â–¼\n4. Check: Is user on cooldown?\n         â”‚ No\n         â–¼\n5. Build context\n   â”œâ”€ Get channel messages\n   â”œâ”€ Get conversation history\n   â”œâ”€ Retrieve relevant memories\n   â”œâ”€ Load personality state\n   â””â”€ Get current mood\n         â”‚\n         â–¼\n6. Construct messages array\n   â”œâ”€ System prompt (personality + context)\n   â”œâ”€ Recent history\n   â””â”€ User's message\n         â”‚\n         â–¼\n7. Call OpenRouter API\n         â”‚\n         â–¼\n8. Check for tool calls\n         â”‚\n    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”\n    â”‚         â”‚\n  None     Tool call\n    â”‚         â”‚\n    â”‚         â–¼\n    â”‚    Execute tool\n    â”‚         â”‚\n    â”‚         â–¼\n    â”‚    Continue generation\n    â”‚         â”‚\n    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜\n         â”‚\n         â–¼\n9. Send response\n         â”‚\n         â–¼\n10. Post-processing (LLM-powered)\n    â”œâ”€ Update conversation history\n    â”œâ”€ Extract memories (if enabled)\n    â”œâ”€ LLM: Evaluate mood (evaluateMood)\n    â”œâ”€ LLM: Evaluate relationship (evaluateRelationship)\n    â””â”€ Apply mood/relationship changes"])</script><script>self.__next_f.push([1,"12:[[\"$\",\"h1\",null,{\"id\":\"message-flow\",\"children\":\"Message Flow\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"How messages flow through Beboa's architecture.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"high-level-flow\",\"children\":[\"$\",\"a\",null,{\"href\":\"#high-level-flow\",\"className\":\"anchor-link\",\"children\":\"High-Level Flow\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"Discord Gateway\\n      â”‚\\n      â–¼\\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\\nâ”‚  Discord.js     â”‚\\nâ”‚  Client         â”‚\\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\\n         â”‚\\n         â–¼\\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\\nâ”‚ Event Router    â”‚â”€â”€â”€â”€â–¶â”‚ Slash Commands  â”‚\\nâ”‚                 â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\\nâ”‚ messageCreate   â”‚\\nâ”‚ interactionCreateâ”‚\\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\\n         â”‚\\n         â–¼\\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\\nâ”‚ Message Handler â”‚\\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\\n         â”‚\\n    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”\\n    â”‚         â”‚\\n    â–¼         â–¼\\n@Mention   Jarvis Mode\\n    â”‚         â”‚\\n    â–¼         â–¼\\nChat AI    Admin Command\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"slash-command-flow\",\"children\":[\"$\",\"a\",null,{\"href\":\"#slash-command-flow\",\"className\":\"anchor-link\",\"children\":\"Slash Command Flow\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When a user runs \",[\"$\",\"code\",null,{\"children\":\"/checkin\"}],\":\"]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"1. User types /checkin\\n         â”‚\\n         â–¼\\n2. Discord sends interactionCreate event\\n         â”‚\\n         â–¼\\n3. interactionCreate.js routes to command\\n         â”‚\\n         â–¼\\n4. commands/checkin.js executes\\n         â”‚\\n         â–¼\\n5. database.js performs check-in logic\\n         â”‚\\n         â–¼\\n6. Response sent via interaction.reply()\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"detailed-sequence\",\"children\":[\"$\",\"a\",null,{\"href\":\"#detailed-sequence\",\"className\":\"anchor-link\",\"children\":\"Detailed Sequence\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// 1. Event received\\nclient.on('interactionCreate', async (interaction) =\u003e {\\n\\n    // 2. Check if it's a command\\n    if (!interaction.isChatInputCommand()) return;\\n\\n    // 3. Get command handler\\n    const command = commands.get(interaction.commandName);\\n\\n    // 4. Execute command\\n    try {\\n        await command.execute(interaction);\\n    } catch (error) {\\n        await interaction.reply({ content: 'Error!', ephemeral: true });\\n    }\\n});\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"chat-message-flow\",\"children\":[\"$\",\"a\",null,{\"href\":\"#chat-message-flow\",\"className\":\"anchor-link\",\"children\":\"Chat Message Flow\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When a user @mentions Beboa:\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"$16\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"code-flow\",\"children\":[\"$\",\"a\",null,{\"href\":\"#code-flow\",\"className\":\"anchor-link\",\"children\":\"Code Flow\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// messageCreate.js\\nexport async function execute(message) {\\n    // Skip bots\\n    if (message.author.bot) return;\\n\\n    // Check for mention\\n    if (message.mentions.has(client.user)) {\\n        await handleMention(message);\\n        return;\\n    }\\n\\n    // Check for Jarvis Mode\\n    if (await isJarvisUser(message.author.id)) {\\n        const result = await handleJarvisCommand(message);\\n        if (result.handled) return;\\n    }\\n}\\n\\nasync function handleMention(message) {\\n    const userId = message.author.id;\\n\\n    // Cooldown check\\n    if (await isOnCooldown(userId)) {\\n        return message.reply(\\\"Please wait a moment!\\\");\\n    }\\n\\n    // Set cooldown\\n    setCooldown(userId);\\n\\n    // Build context\\n    const context = await buildChatContext(userId, message.channel);\\n\\n    // Generate response\\n    const response = await chat.handleChat(message, context);\\n\\n    // Handle response (may include tool results)\\n    await sendResponse(message, response);\\n}\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"jarvis-mode-flow-llm-first\",\"children\":[\"$\",\"a\",null,{\"href\":\"#jarvis-mode-flow-llm-first\",\"className\":\"anchor-link\",\"children\":\"Jarvis Mode Flow (LLM-First)\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When a Jarvis user sends a command:\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"1. User sends \\\"give @user 100 bebits\\\"\\n         â”‚\\n         â–¼\\n2. messageCreate event fires\\n         â”‚\\n         â–¼\\n3. Check: Is user a Jarvis user?\\n         â”‚ Yes\\n         â–¼\\n4. Stage 1: Check pending confirmations\\n         â”‚ None pending\\n         â–¼\\n5. Stage 2: LLM Intent Parser (PRIMARY)\\n   â””â”€ parseJarvisIntent(\\\"give @user 100 bebits\\\")\\n         â”‚\\n         â–¼\\n   LLM Response:\\n   â”œâ”€ command: \\\"give_bebits\\\"\\n   â”œâ”€ confidence: 0.92\\n   â”œâ”€ params: { targetUserId, amount: 100 }\\n   â””â”€ requiresConfirmation: false\\n         â”‚ confidence \u003e 0.6\\n         â–¼\\n6. Execute command\\n   â””â”€ database.addBebits(userId, 100)\\n         â”‚\\n         â–¼\\n7. Send response\\n   â””â”€ \\\"Gave 100 bebits to @user!\\\"\\n         â”‚\\n         â–¼\\n8. Update context\\n   â”œâ”€ lastMentionedUser = @user\\n   â””â”€ lastCommand = give_bebits\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"fallback-path-llm-unavailable\",\"children\":[\"$\",\"a\",null,{\"href\":\"#fallback-path-llm-unavailable\",\"className\":\"anchor-link\",\"children\":\"Fallback Path (LLM unavailable)\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"5. Stage 2: LLM Intent Parser\\n         â”‚ Returns null (rate limited)\\n         â–¼\\n6. Stage 3: Pattern Matching (FALLBACK)\\n   â””â”€ Regex: /give\\\\s+(?:\u003c@!?)?(\\\\d+)\u003e?\\\\s+(\\\\d+)/\\n         â”‚ Match found\\n         â–¼\\n7. Execute command\\n   â””â”€ Continue as normal\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"confirmation-flow\",\"children\":[\"$\",\"a\",null,{\"href\":\"#confirmation-flow\",\"className\":\"anchor-link\",\"children\":\"Confirmation Flow\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"For commands requiring confirmation:\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"1. \\\"give everyone 1000 bebits\\\"\\n         â”‚\\n         â–¼\\n2. Parse and validate\\n   â””â”€ requiresConfirmation = true\\n         â”‚\\n         â–¼\\n3. Send confirmation request\\n   â””â”€ \\\"This will give 1000 to 50 users. Confirm?\\\"\\n         â”‚\\n         â–¼\\n4. Store pending confirmation\\n   â””â”€ pendingConfirmations[userId] = { command, params }\\n         â”‚\\n         â–¼\\n5. Wait for next message\\n         â”‚\\n         â–¼\\n6. User sends \\\"confirm\\\"\\n         â”‚\\n         â–¼\\n7. Check pending confirmations\\n   â””â”€ Found pending for this user\\n         â”‚\\n         â–¼\\n8. Execute original command\\n         â”‚\\n         â–¼\\n9. Clear pending confirmation\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"tool-call-flow\",\"children\":[\"$\",\"a\",null,{\"href\":\"#tool-call-flow\",\"className\":\"anchor-link\",\"children\":\"Tool Call Flow\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When the AI decides to use a tool:\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"1. AI response includes tool_call\\n   â””â”€ { name: \\\"generate_image\\\", arguments: { prompt: \\\"cute snake\\\" } }\\n         â”‚\\n         â–¼\\n2. Parse tool call\\n         â”‚\\n         â–¼\\n3. Execute tool\\n   â””â”€ tools.generateImage(\\\"cute snake\\\")\\n         â”‚\\n         â–¼\\n4. Get result\\n   â””â”€ { success: true, url: \\\"https://...\\\" }\\n         â”‚\\n         â–¼\\n5. Send image to channel\\n         â”‚\\n         â–¼\\n6. (Optional) Continue conversation\\n   â””â”€ AI may add text response after tool\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"memory-extraction-flow\",\"children\":[\"$\",\"a\",null,{\"href\":\"#memory-extraction-flow\",\"className\":\"anchor-link\",\"children\":\"Memory Extraction Flow\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Post-conversation memory processing:\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"1. Conversation complete\\n         â”‚\\n         â–¼\\n2. Check: MEMORY_AUTO_EXTRACT enabled?\\n         â”‚ Yes\\n         â–¼\\n3. Send conversation to extraction model\\n         â”‚\\n         â–¼\\n4. AI extracts facts\\n   â””â”€ [{ content: \\\"User likes cats\\\", type: \\\"preference\\\", importance: 0.7 }]\\n         â”‚\\n         â–¼\\n5. For each extracted memory:\\n   â”œâ”€ Generate embedding\\n   â””â”€ Store in database\\n         â”‚\\n         â–¼\\n6. Log extraction results\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"error-handling-flow\",\"children\":[\"$\",\"a\",null,{\"href\":\"#error-handling-flow\",\"className\":\"anchor-link\",\"children\":\"Error Handling Flow\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"1. Error occurs at any stage\\n         â”‚\\n         â–¼\\n2. Catch error in handler\\n         â”‚\\n         â–¼\\n3. Log error details\\n         â”‚\\n         â–¼\\n4. Determine error type\\n         â”‚\\n    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\\n    â”‚         â”‚          â”‚\\n  API Error  DB Error  Other\\n    â”‚         â”‚          â”‚\\n    â–¼         â–¼          â–¼\\n\\\"AI busy\\\"  \\\"Oops!\\\"   Generic\\n         â”‚\\n         â–¼\\n5. Send user-friendly error message\\n         â”‚\\n         â–¼\\n6. (Optional) Notify admin for critical errors\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"performance-considerations\",\"children\":[\"$\",\"a\",null,{\"href\":\"#performance-considerations\",\"className\":\"anchor-link\",\"children\":\"Performance Considerations\"}]}],\"\\n\",[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Stage\"}],[\"$\",\"th\",null,{\"children\":\"Typical Latency\"}],[\"$\",\"th\",null,{\"children\":\"Notes\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Discord event\"}],[\"$\",\"td\",null,{\"children\":\"\u003c50ms\"}],[\"$\",\"td\",null,{\"children\":\"Gateway to handler\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Database query\"}],[\"$\",\"td\",null,{\"children\":\"\u003c10ms\"}],[\"$\",\"td\",null,{\"children\":\"SQLite is fast\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Context building\"}],[\"$\",\"td\",null,{\"children\":\"50-100ms\"}],[\"$\",\"td\",null,{\"children\":\"Multiple queries\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"OpenRouter API\"}],[\"$\",\"td\",null,{\"children\":\"500-3000ms\"}],[\"$\",\"td\",null,{\"children\":\"Main bottleneck\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Memory search\"}],[\"$\",\"td\",null,{\"children\":\"100-200ms\"}],[\"$\",\"td\",null,{\"children\":\"Embedding + similarity\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Tool execution\"}],[\"$\",\"td\",null,{\"children\":\"500-5000ms\"}],[\"$\",\"td\",null,{\"children\":\"Varies by tool\"}]]}]]}]]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"optimization-tips\",\"children\":[\"$\",\"a\",null,{\"href\":\"#optimization-tips\",\"className\":\"anchor-link\",\"children\":\"Optimization Tips\"}]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Parallel queries\"}],\" - Build context concurrently\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Cache personality\"}],\" - Doesn't change often\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Limit history\"}],\" - Don't send full history every time\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Batch embeddings\"}],\" - For multi-memory extraction\"]}],\"\\n\"]}]]\n"])</script></body></html>