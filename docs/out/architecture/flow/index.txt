3:I[4707,[],""]
5:I[6423,[],""]
6:I[2060,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","185","static/chunks/app/layout-4b75b78215e64ea2.js"],"ThemeProvider"]
7:I[4351,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","185","static/chunks/app/layout-4b75b78215e64ea2.js"],"Header"]
8:I[9399,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","185","static/chunks/app/layout-4b75b78215e64ea2.js"],"Sidebar"]
4:["slug","architecture/flow","c"]
0:["FeUt14WxB_Uw-6zJdn3nr",[[["",{"children":[["slug","architecture/flow","c"],{"children":["__PAGE__?{\"slug\":[\"architecture\",\"flow\"]}",{}]}]},"$undefined","$undefined",true],["",{"children":[["slug","architecture/flow","c"],{"children":["__PAGE__",{},[["$L1","$L2",null],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3cf59f0fd0496c15.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":["$","body",null,{"className":"__variable_f367f3 __variable_a06722 font-sans","children":["$","$L6",null,{"children":["$","div",null,{"className":"min-h-screen bg-[var(--bg-primary)] transition-colors duration-200","children":[["$","$L7",null,{}],["$","div",null,{"className":"flex","children":[["$","$L8",null,{}],["$","main",null,{"className":"flex-1 min-w-0 lg:pl-[var(--sidebar-width)]","children":["$","div",null,{"className":"max-w-[var(--content-max-width)] mx-auto px-6 py-8 lg:px-8 lg:py-12","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[]}]}]}]]}]]}]}]}]}]],null],null],["$L9",null]]]]
a:I[6430,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"Breadcrumbs"]
b:I[9078,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"CopyPageButton"]
d:I[3308,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"PageNavigation"]
e:I[5321,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"TableOfContents"]
2:[["$","article",null,{"className":"animate-in","children":[["$","div",null,{"className":"flex items-start justify-between gap-4 mb-6","children":[["$","$La",null,{}],["$","$Lb",null,{}]]}],["$","h1",null,{"children":"Message Flow"}],["$","p",null,{"className":"text-lg text-[var(--text-secondary)] mb-8 -mt-2","children":"How messages flow through Beboa's architecture."}],["$","div",null,{"className":"prose-custom","children":"$Lc"}],["$","$Ld",null,{}]]}],["$","$Le",null,{}]]
9:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Message Flow - Beboa Docs"}],["$","meta","3",{"name":"description","content":"How messages flow through Beboa's architecture."}],["$","link","4",{"rel":"icon","href":"/favicon.ico"}],["$","meta","5",{"name":"next-size-adjust"}]]
1:null
f:I[5045,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"CodeBlock"]
10:T4fe,1. User sends "@Beboa hello!"
         │
         ▼
2. messageCreate event fires
         │
         ▼
3. Check: Is Beboa mentioned?
         │ Yes
         ▼
4. Check: Is user on cooldown?
         │ No
         ▼
5. Build context
   ├─ Get channel messages
   ├─ Get conversation history
   ├─ Retrieve relevant memories
   ├─ Load personality state
   └─ Get current mood
         │
         ▼
6. Construct messages array
   ├─ System prompt (personality + context)
   ├─ Recent history
   └─ User's message
         │
         ▼
7. Call OpenRouter API
         │
         ▼
8. Check for tool calls
         │
    ┌────┴────┐
    │         │
  None     Tool call
    │         │
    │         ▼
    │    Execute tool
    │         │
    │         ▼
    │    Continue generation
    │         │
    └────┬────┘
         │
         ▼
9. Send response
         │
         ▼
10. Post-processing (LLM-powered)
    ├─ Update conversation history
    ├─ Extract memories (if enabled)
    ├─ LLM: Evaluate mood (evaluateMood)
    ├─ LLM: Evaluate relationship (evaluateRelationship)
    └─ Apply mood/relationship changesc:[["$","h1",null,{"id":"message-flow","children":"Message Flow"}],"\n",["$","p",null,{"children":"How messages flow through Beboa's architecture."}],"\n",["$","h2",null,{"id":"high-level-flow","children":["$","a",null,{"href":"#high-level-flow","className":"anchor-link","children":"High-Level Flow"}]}],"\n",["$","$Lf",null,{"language":"$undefined","children":"Discord Gateway\n      │\n      ▼\n┌─────────────────┐\n│  Discord.js     │\n│  Client         │\n└────────┬────────┘\n         │\n         ▼\n┌─────────────────┐     ┌─────────────────┐\n│ Event Router    │────▶│ Slash Commands  │\n│                 │     └─────────────────┘\n│ messageCreate   │\n│ interactionCreate│\n└────────┬────────┘\n         │\n         ▼\n┌─────────────────┐\n│ Message Handler │\n└────────┬────────┘\n         │\n    ┌────┴────┐\n    │         │\n    ▼         ▼\n@Mention   Jarvis Mode\n    │         │\n    ▼         ▼\nChat AI    Admin Command"}],"\n",["$","h2",null,{"id":"slash-command-flow","children":["$","a",null,{"href":"#slash-command-flow","className":"anchor-link","children":"Slash Command Flow"}]}],"\n",["$","p",null,{"children":["When a user runs ",["$","code",null,{"children":"/checkin"}],":"]}],"\n",["$","$Lf",null,{"language":"$undefined","children":"1. User types /checkin\n         │\n         ▼\n2. Discord sends interactionCreate event\n         │\n         ▼\n3. interactionCreate.js routes to command\n         │\n         ▼\n4. commands/checkin.js executes\n         │\n         ▼\n5. database.js performs check-in logic\n         │\n         ▼\n6. Response sent via interaction.reply()"}],"\n",["$","h3",null,{"id":"detailed-sequence","children":["$","a",null,{"href":"#detailed-sequence","className":"anchor-link","children":"Detailed Sequence"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// 1. Event received\nclient.on('interactionCreate', async (interaction) => {\n\n    // 2. Check if it's a command\n    if (!interaction.isChatInputCommand()) return;\n\n    // 3. Get command handler\n    const command = commands.get(interaction.commandName);\n\n    // 4. Execute command\n    try {\n        await command.execute(interaction);\n    } catch (error) {\n        await interaction.reply({ content: 'Error!', ephemeral: true });\n    }\n});"}],"\n",["$","h2",null,{"id":"chat-message-flow","children":["$","a",null,{"href":"#chat-message-flow","className":"anchor-link","children":"Chat Message Flow"}]}],"\n",["$","p",null,{"children":"When a user @mentions Beboa:"}],"\n",["$","$Lf",null,{"language":"$undefined","children":"$10"}],"\n",["$","h3",null,{"id":"code-flow","children":["$","a",null,{"href":"#code-flow","className":"anchor-link","children":"Code Flow"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// messageCreate.js\nexport async function execute(message) {\n    // Skip bots\n    if (message.author.bot) return;\n\n    // Check for mention\n    if (message.mentions.has(client.user)) {\n        await handleMention(message);\n        return;\n    }\n\n    // Check for Jarvis Mode\n    if (await isJarvisUser(message.author.id)) {\n        const result = await handleJarvisCommand(message);\n        if (result.handled) return;\n    }\n}\n\nasync function handleMention(message) {\n    const userId = message.author.id;\n\n    // Cooldown check\n    if (await isOnCooldown(userId)) {\n        return message.reply(\"Please wait a moment!\");\n    }\n\n    // Set cooldown\n    setCooldown(userId);\n\n    // Build context\n    const context = await buildChatContext(userId, message.channel);\n\n    // Generate response\n    const response = await chat.handleChat(message, context);\n\n    // Handle response (may include tool results)\n    await sendResponse(message, response);\n}"}],"\n",["$","h2",null,{"id":"jarvis-mode-flow-llm-first","children":["$","a",null,{"href":"#jarvis-mode-flow-llm-first","className":"anchor-link","children":"Jarvis Mode Flow (LLM-First)"}]}],"\n",["$","p",null,{"children":"When a Jarvis user sends a command:"}],"\n",["$","$Lf",null,{"language":"$undefined","children":"1. User sends \"give @user 100 bebits\"\n         │\n         ▼\n2. messageCreate event fires\n         │\n         ▼\n3. Check: Is user a Jarvis user?\n         │ Yes\n         ▼\n4. Stage 1: Check pending confirmations\n         │ None pending\n         ▼\n5. Stage 2: LLM Intent Parser (PRIMARY)\n   └─ parseJarvisIntent(\"give @user 100 bebits\")\n         │\n         ▼\n   LLM Response:\n   ├─ command: \"give_bebits\"\n   ├─ confidence: 0.92\n   ├─ params: { targetUserId, amount: 100 }\n   └─ requiresConfirmation: false\n         │ confidence > 0.6\n         ▼\n6. Execute command\n   └─ database.addBebits(userId, 100)\n         │\n         ▼\n7. Send response\n   └─ \"Gave 100 bebits to @user!\"\n         │\n         ▼\n8. Update context\n   ├─ lastMentionedUser = @user\n   └─ lastCommand = give_bebits"}],"\n",["$","h3",null,{"id":"fallback-path-llm-unavailable","children":["$","a",null,{"href":"#fallback-path-llm-unavailable","className":"anchor-link","children":"Fallback Path (LLM unavailable)"}]}],"\n",["$","$Lf",null,{"language":"$undefined","children":"5. Stage 2: LLM Intent Parser\n         │ Returns null (rate limited)\n         ▼\n6. Stage 3: Pattern Matching (FALLBACK)\n   └─ Regex: /give\\s+(?:<@!?)?(\\d+)>?\\s+(\\d+)/\n         │ Match found\n         ▼\n7. Execute command\n   └─ Continue as normal"}],"\n",["$","h3",null,{"id":"confirmation-flow","children":["$","a",null,{"href":"#confirmation-flow","className":"anchor-link","children":"Confirmation Flow"}]}],"\n",["$","p",null,{"children":"For commands requiring confirmation:"}],"\n",["$","$Lf",null,{"language":"$undefined","children":"1. \"give everyone 1000 bebits\"\n         │\n         ▼\n2. Parse and validate\n   └─ requiresConfirmation = true\n         │\n         ▼\n3. Send confirmation request\n   └─ \"This will give 1000 to 50 users. Confirm?\"\n         │\n         ▼\n4. Store pending confirmation\n   └─ pendingConfirmations[userId] = { command, params }\n         │\n         ▼\n5. Wait for next message\n         │\n         ▼\n6. User sends \"confirm\"\n         │\n         ▼\n7. Check pending confirmations\n   └─ Found pending for this user\n         │\n         ▼\n8. Execute original command\n         │\n         ▼\n9. Clear pending confirmation"}],"\n",["$","h2",null,{"id":"tool-call-flow","children":["$","a",null,{"href":"#tool-call-flow","className":"anchor-link","children":"Tool Call Flow"}]}],"\n",["$","p",null,{"children":"When the AI decides to use a tool:"}],"\n",["$","$Lf",null,{"language":"$undefined","children":"1. AI response includes tool_call\n   └─ { name: \"generate_image\", arguments: { prompt: \"cute snake\" } }\n         │\n         ▼\n2. Parse tool call\n         │\n         ▼\n3. Execute tool\n   └─ tools.generateImage(\"cute snake\")\n         │\n         ▼\n4. Get result\n   └─ { success: true, url: \"https://...\" }\n         │\n         ▼\n5. Send image to channel\n         │\n         ▼\n6. (Optional) Continue conversation\n   └─ AI may add text response after tool"}],"\n",["$","h2",null,{"id":"memory-extraction-flow","children":["$","a",null,{"href":"#memory-extraction-flow","className":"anchor-link","children":"Memory Extraction Flow"}]}],"\n",["$","p",null,{"children":"Post-conversation memory processing:"}],"\n",["$","$Lf",null,{"language":"$undefined","children":"1. Conversation complete\n         │\n         ▼\n2. Check: MEMORY_AUTO_EXTRACT enabled?\n         │ Yes\n         ▼\n3. Send conversation to extraction model\n         │\n         ▼\n4. AI extracts facts\n   └─ [{ content: \"User likes cats\", type: \"preference\", importance: 0.7 }]\n         │\n         ▼\n5. For each extracted memory:\n   ├─ Generate embedding\n   └─ Store in database\n         │\n         ▼\n6. Log extraction results"}],"\n",["$","h2",null,{"id":"error-handling-flow","children":["$","a",null,{"href":"#error-handling-flow","className":"anchor-link","children":"Error Handling Flow"}]}],"\n",["$","$Lf",null,{"language":"$undefined","children":"1. Error occurs at any stage\n         │\n         ▼\n2. Catch error in handler\n         │\n         ▼\n3. Log error details\n         │\n         ▼\n4. Determine error type\n         │\n    ┌────┴────┬──────────┐\n    │         │          │\n  API Error  DB Error  Other\n    │         │          │\n    ▼         ▼          ▼\n\"AI busy\"  \"Oops!\"   Generic\n         │\n         ▼\n5. Send user-friendly error message\n         │\n         ▼\n6. (Optional) Notify admin for critical errors"}],"\n",["$","h2",null,{"id":"performance-considerations","children":["$","a",null,{"href":"#performance-considerations","className":"anchor-link","children":"Performance Considerations"}]}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"Stage"}],["$","th",null,{"children":"Typical Latency"}],["$","th",null,{"children":"Notes"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":"Discord event"}],["$","td",null,{"children":"<50ms"}],["$","td",null,{"children":"Gateway to handler"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"Database query"}],["$","td",null,{"children":"<10ms"}],["$","td",null,{"children":"SQLite is fast"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"Context building"}],["$","td",null,{"children":"50-100ms"}],["$","td",null,{"children":"Multiple queries"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"OpenRouter API"}],["$","td",null,{"children":"500-3000ms"}],["$","td",null,{"children":"Main bottleneck"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"Memory search"}],["$","td",null,{"children":"100-200ms"}],["$","td",null,{"children":"Embedding + similarity"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"Tool execution"}],["$","td",null,{"children":"500-5000ms"}],["$","td",null,{"children":"Varies by tool"}]]}]]}]]}],"\n",["$","h3",null,{"id":"optimization-tips","children":["$","a",null,{"href":"#optimization-tips","className":"anchor-link","children":"Optimization Tips"}]}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Parallel queries"}]," - Build context concurrently"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Cache personality"}]," - Doesn't change often"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Limit history"}]," - Don't send full history every time"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Batch embeddings"}]," - For multi-memory extraction"]}],"\n"]}]]
