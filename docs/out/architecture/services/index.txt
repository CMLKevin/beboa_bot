3:I[4707,[],""]
5:I[6423,[],""]
6:I[2060,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","185","static/chunks/app/layout-4b75b78215e64ea2.js"],"ThemeProvider"]
7:I[4351,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","185","static/chunks/app/layout-4b75b78215e64ea2.js"],"Header"]
8:I[9399,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","185","static/chunks/app/layout-4b75b78215e64ea2.js"],"Sidebar"]
4:["slug","architecture/services","c"]
0:["FeUt14WxB_Uw-6zJdn3nr",[[["",{"children":[["slug","architecture/services","c"],{"children":["__PAGE__?{\"slug\":[\"architecture\",\"services\"]}",{}]}]},"$undefined","$undefined",true],["",{"children":[["slug","architecture/services","c"],{"children":["__PAGE__",{},[["$L1","$L2",null],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3cf59f0fd0496c15.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":["$","body",null,{"className":"__variable_f367f3 __variable_a06722 font-sans","children":["$","$L6",null,{"children":["$","div",null,{"className":"min-h-screen bg-[var(--bg-primary)] transition-colors duration-200","children":[["$","$L7",null,{}],["$","div",null,{"className":"flex","children":[["$","$L8",null,{}],["$","main",null,{"className":"flex-1 min-w-0 lg:pl-[var(--sidebar-width)]","children":["$","div",null,{"className":"max-w-[var(--content-max-width)] mx-auto px-6 py-8 lg:px-8 lg:py-12","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[]}]}]}]]}]]}]}]}]}]],null],null],["$L9",null]]]]
a:I[6430,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"Breadcrumbs"]
b:I[9078,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"CopyPageButton"]
d:I[3308,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"PageNavigation"]
e:I[5321,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"TableOfContents"]
2:[["$","article",null,{"className":"animate-in","children":[["$","div",null,{"className":"flex items-start justify-between gap-4 mb-6","children":[["$","$La",null,{}],["$","$Lb",null,{}]]}],["$","h1",null,{"children":"Services"}],["$","p",null,{"className":"text-lg text-[var(--text-secondary)] mb-8 -mt-2","children":"Deep dive into the service layer modules and business logic."}],["$","div",null,{"className":"prose-custom","children":"$Lc"}],["$","$Ld",null,{}]]}],["$","$Le",null,{}]]
9:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Services - Beboa Docs"}],["$","meta","3",{"name":"description","content":"Deep dive into the service layer modules and business logic."}],["$","link","4",{"rel":"icon","href":"/favicon.ico"}],["$","meta","5",{"name":"next-size-adjust"}]]
1:null
f:I[5045,["972","static/chunks/972-68a674eeca97bbbb.js","646","static/chunks/646-1e67c3e800eb58dd.js","877","static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js"],"CodeBlock"]
10:T95c,┌────────────────────────────────────────────────────┐
│                   Event Handlers                    │
│         (commands/, events/)                       │
└────────────────────────┬───────────────────────────┘
                         │
                         ▼
┌────────────────────────────────────────────────────┐
│                   Services Layer                    │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │ database │ │openrouter│ │   chat   │           │
│  └──────────┘ └──────────┘ └──────────┘           │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │  memory  │ │personality│ │  tools   │           │
│  └──────────┘ └──────────┘ └──────────┘           │
│  ┌────────────────────┐ ┌────────────────────┐    │
│  │   llmEvaluator     │ │   adminCommands    │    │
│  └────────────────────┘ └────────────────────┘    │
│  ┌────────────────────────────────────────────┐   │
│  │         Server Memory Services              │   │
│  │  messageIngestion | embeddingQueue          │   │
│  │  serverMemory     | summarizer              │   │
│  └────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────┘11:T4d4,export async function handleChat(message, context = {}) {
    const userId = message.author.id;

    // 1. Check cooldown
    if (isOnCooldown(userId)) {
        return message.reply("Slow down!");
    }

    // 2. Build context
    const chatContext = await buildContext(userId, message.channel.id);

    // 3. Get personality/mood
    const personality = await getPersonality();
    const mood = await getCurrentMood();

    // 4. Retrieve relevant memories
    const memories = await searchMemories(userId, message.content, 5);

    // 5. Build messages array
    const messages = [
        { role: 'system', content: buildSystemPrompt(personality, mood, memories) },
        ...chatContext.history,
        { role: 'user', content: message.content }
    ];

    // 6. Generate response
    const response = await generateResponse(messages, {
        tools: getEnabledTools()
    });

    // 7. Handle tool calls if present
    if (response.choices[0].message.tool_calls) {
        await handleToolCalls(response, message);
    }

    // 8. Send response
    await message.reply(response.choices[0].message.content);

    // 9. Post-process (memory extraction, mood update)
    await postProcess(userId, message.content, response);
}c:[["$","h1",null,{"id":"services-architecture","children":"Services Architecture"}],"\n",["$","p",null,{"children":"Deep dive into the service layer modules."}],"\n",["$","h2",null,{"id":"overview","children":["$","a",null,{"href":"#overview","className":"anchor-link","children":"Overview"}]}],"\n",["$","p",null,{"children":"Services contain business logic, separated from Discord event handling."}],"\n",["$","$Lf",null,{"language":"$undefined","children":"$10"}],"\n",["$","h2",null,{"id":"databasejs","children":["$","a",null,{"href":"#databasejs","className":"anchor-link","children":"database.js"}]}],"\n",["$","p",null,{"children":"SQLite database operations."}],"\n",["$","h3",null,{"id":"key-functions","children":["$","a",null,{"href":"#key-functions","className":"anchor-link","children":"Key Functions"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// User operations\nexport function getUser(userId)\nexport function createUser(userId, username)\nexport function updateUser(userId, data)\nexport function deleteUser(userId)\n\n// Bebits operations\nexport function addBebits(userId, amount)\nexport function removeBebits(userId, amount)\nexport function setBebits(userId, amount)\nexport function transferBebits(fromId, toId, amount)\n\n// Check-in operations\nexport function performCheckin(userId)\nexport function getStreak(userId)\nexport function resetStreak(userId)\n\n// Leaderboard\nexport function getLeaderboard(limit = 10)\nexport function getUserRank(userId)\n\n// Relationships\nexport function getRelationship(userId)\nexport function updateTrust(userId, delta)\nexport function setRelationshipStage(userId, stage)"}],"\n",["$","h3",null,{"id":"connection-management","children":["$","a",null,{"href":"#connection-management","className":"anchor-link","children":"Connection Management"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"import Database from 'better-sqlite3';\n\nconst db = new Database('data/beboa.db');\n\n// Enable WAL mode for better concurrency\ndb.pragma('journal_mode = WAL');\n\n// Graceful shutdown\nprocess.on('exit', () => db.close());"}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"openrouterjs","children":["$","a",null,{"href":"#openrouterjs","className":"anchor-link","children":"openrouter.js"}]}],"\n",["$","p",null,{"children":"OpenRouter API client."}],"\n",["$","h3",null,{"id":"key-functions-1","children":["$","a",null,{"href":"#key-functions-1","className":"anchor-link","children":"Key Functions"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Chat completion\nexport async function generateResponse(messages, options = {})\n\n// Embeddings\nexport async function generateEmbedding(text)\n\n// Image generation\nexport async function generateImage(prompt, options = {})"}],"\n",["$","h3",null,{"id":"api-call-structure","children":["$","a",null,{"href":"#api-call-structure","className":"anchor-link","children":"API Call Structure"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"export async function generateResponse(messages, options = {}) {\n    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n            'Authorization': `Bearer ${process.env.OPENROUTER_API_KEY}`,\n            'Content-Type': 'application/json',\n            'HTTP-Referer': 'https://github.com/CMLKevin/beboa_evo',\n            'X-Title': 'Beboa Discord Bot'\n        },\n        body: JSON.stringify({\n            model: options.model || process.env.OPENROUTER_MODEL,\n            messages,\n            max_tokens: options.maxTokens || parseInt(process.env.OPENROUTER_MAX_TOKENS),\n            temperature: options.temperature || parseFloat(process.env.OPENROUTER_TEMPERATURE),\n            tools: options.tools || undefined\n        })\n    });\n\n    return response.json();\n}"}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"chatjs","children":["$","a",null,{"href":"#chatjs","className":"anchor-link","children":"chat.js"}]}],"\n",["$","p",null,{"children":"Chat processing and context management."}],"\n",["$","h3",null,{"id":"key-functions-2","children":["$","a",null,{"href":"#key-functions-2","className":"anchor-link","children":"Key Functions"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Main chat handler\nexport async function handleChat(message, context = {})\n\n// Context building\nexport async function buildContext(userId, channelId)\n\n// History management\nexport function addToHistory(userId, role, content)\nexport function getHistory(userId, limit)\nexport function clearHistory(userId)"}],"\n",["$","h3",null,{"id":"chat-processing-flow","children":["$","a",null,{"href":"#chat-processing-flow","className":"anchor-link","children":"Chat Processing Flow"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"$11"}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"memoryjs","children":["$","a",null,{"href":"#memoryjs","className":"anchor-link","children":"memory.js"}]}],"\n",["$","p",null,{"children":"Semantic memory system."}],"\n",["$","h3",null,{"id":"key-functions-3","children":["$","a",null,{"href":"#key-functions-3","className":"anchor-link","children":"Key Functions"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Memory CRUD\nexport async function addMemory(userId, content, type, importance)\nexport async function getMemories(userId, limit)\nexport async function searchMemories(userId, query, limit)\nexport async function deleteMemory(memoryId)\n\n// Embedding operations\nexport async function generateEmbedding(text)\nexport function cosineSimilarity(a, b)\n\n// Auto-extraction\nexport async function extractMemories(userId, conversation)"}],"\n",["$","h3",null,{"id":"semantic-search","children":["$","a",null,{"href":"#semantic-search","className":"anchor-link","children":"Semantic Search"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"export async function searchMemories(userId, query, limit = 5) {\n    // Generate query embedding\n    const queryEmbedding = await generateEmbedding(query);\n\n    // Get all user memories\n    const memories = db.prepare(`\n        SELECT * FROM memories\n        WHERE user_id = ?\n    `).all(userId);\n\n    // Compute similarities\n    const scored = memories.map(memory => ({\n        ...memory,\n        embedding: deserializeEmbedding(memory.embedding),\n        similarity: cosineSimilarity(queryEmbedding, deserializeEmbedding(memory.embedding))\n    }));\n\n    // Filter and sort\n    return scored\n        .filter(m => m.similarity >= 0.7)\n        .sort((a, b) => b.similarity - a.similarity)\n        .slice(0, limit);\n}"}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"personalityjs","children":["$","a",null,{"href":"#personalityjs","className":"anchor-link","children":"personality.js"}]}],"\n",["$","p",null,{"children":"Personality and mood management."}],"\n",["$","h3",null,{"id":"key-functions-4","children":["$","a",null,{"href":"#key-functions-4","className":"anchor-link","children":"Key Functions"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Personality\nexport async function getPersonality()\nexport async function updateTrait(trait, value)\nexport async function resetPersonality()\nexport async function evolveTrait(trait, delta)\n\n// Mood\nexport async function getCurrentMood()\nexport async function setMood(mood, intensity)\nexport async function shiftMood(mood, amount)\n\n// Relationships\nexport async function getRelationshipStage(userId)\nexport async function updateRelationship(userId, interaction)"}],"\n",["$","h3",null,{"id":"trait-evolution","children":["$","a",null,{"href":"#trait-evolution","className":"anchor-link","children":"Trait Evolution"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"export async function evolveTrait(trait, delta) {\n    const current = await getPersonality();\n    let newValue = current[trait] + delta;\n\n    // Clamp between 0.1 and 0.9\n    newValue = Math.max(0.1, Math.min(0.9, newValue));\n\n    db.prepare(`\n        UPDATE personality SET ${trait} = ?, last_updated = ?\n        WHERE id = 1\n    `).run(newValue, new Date().toISOString());\n\n    return newValue;\n}"}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"toolsjs","children":["$","a",null,{"href":"#toolsjs","className":"anchor-link","children":"tools.js"}]}],"\n",["$","p",null,{"children":"Tool call framework."}],"\n",["$","h3",null,{"id":"key-functions-5","children":["$","a",null,{"href":"#key-functions-5","className":"anchor-link","children":"Key Functions"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Tool definitions\nexport function getToolDefinitions()\nexport function getEnabledTools()\n\n// Tool execution\nexport async function executeToolCall(name, args)\nexport async function handleToolCalls(response, message)"}],"\n",["$","h3",null,{"id":"tool-registry","children":["$","a",null,{"href":"#tool-registry","className":"anchor-link","children":"Tool Registry"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"const toolRegistry = {\n    generate_image: {\n        definition: { /* JSON Schema */ },\n        handler: handleImageGeneration,\n        enabled: () => process.env.IMAGE_GEN_ENABLED === 'true'\n    },\n    roll_dice: {\n        definition: { /* JSON Schema */ },\n        handler: handleDiceRoll,\n        enabled: () => true\n    }\n    // Add more tools here\n};\n\nexport function getEnabledTools() {\n    return Object.values(toolRegistry)\n        .filter(tool => tool.enabled())\n        .map(tool => tool.definition);\n}"}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"llmevaluatorjs","children":["$","a",null,{"href":"#llmevaluatorjs","className":"anchor-link","children":"llmEvaluator.js"}]}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":"NEW"}]," - Centralized LLM-powered evaluation service."]}],"\n",["$","h3",null,{"id":"key-functions-6","children":["$","a",null,{"href":"#key-functions-6","className":"anchor-link","children":"Key Functions"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Mood evaluation\nexport async function evaluateMood(message, context)\n// Returns: { sentiment, suggestedMood, moodConfidence, detectedPatterns, ... }\n\n// Relationship evaluation\nexport async function evaluateRelationship(userMessage, botResponse, context)\n// Returns: { interactionQuality, trustIndicators, relationshipDeltas, ... }\n\n// Jarvis intent parsing\nexport async function parseJarvisIntent(message, context)\n// Returns: { isCommand, command, confidence, params, requiresConfirmation, ... }\n\n// Utilities\nexport function isAvailable()      // Check if evaluator can be called\nexport function getCacheStats()    // Cache and rate limit stats\nexport function clearCache()       // Clear response cache"}],"\n",["$","h3",null,{"id":"configuration","children":["$","a",null,{"href":"#configuration","className":"anchor-link","children":"Configuration"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"const EVALUATOR_MODEL = config.LLM_EVALUATOR_MODEL || 'x-ai/grok-4.1-fast';\nconst CACHE_TTL = config.LLM_EVALUATOR_CACHE_TTL || 60000;\nconst RATE_LIMIT_CALLS = config.LLM_EVALUATOR_RATE_LIMIT || 30;"}],"\n",["$","h3",null,{"id":"features","children":["$","a",null,{"href":"#features","className":"anchor-link","children":"Features"}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Rate limiting"}],": 30 calls/minute with queue"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Response caching"}],": 60s TTL on content hash"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Graceful fallback"}],": Returns ",["$","code",null,{"children":"null"}]," to signal fallback needed"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Deterministic"}],": Temperature 0.1 for consistent evaluations"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"admincommandsjs","children":["$","a",null,{"href":"#admincommandsjs","className":"anchor-link","children":"adminCommands.js"}]}],"\n",["$","p",null,{"children":"Jarvis Mode implementation with LLM-first parsing."}],"\n",["$","h3",null,{"id":"key-functions-7","children":["$","a",null,{"href":"#key-functions-7","className":"anchor-link","children":"Key Functions"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Main entry point (now LLM-first)\nexport async function parseAndExecuteAdminCommand(message, context)\n\n// LLM execution\nasync function executeFromLLMIntent(llmIntent, originalMessage, context)\n\n// Fallback parsing\nexport function tryPatternMatch(message)\nexport function analyzeIntent(message)\nexport function extractEntities(message)\n\n// Command execution\nexport async function executeCommand(command, params, context)\n\n// Utilities\nexport function getAvailableAdminCommands()\nexport function isConfirmationPending(userId)"}],"\n",["$","h3",null,{"id":"parsing-pipeline","children":["$","a",null,{"href":"#parsing-pipeline","className":"anchor-link","children":"Parsing Pipeline"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Stage 1: Check pending confirmations\n// Stage 2: LLM Intent Parser (PRIMARY)\n// Stage 3: Pattern Matching (FALLBACK)\n// Stage 4: Intent Keywords (FALLBACK)\n// Stage 5: Context Substitution"}],"\n",["$","h3",null,{"id":"command-registration","children":["$","a",null,{"href":"#command-registration","className":"anchor-link","children":"Command Registration"}]}],"\n",["$","$Lf",null,{"language":"javascript","children":"const commands = {\n    give_bebits: {\n        name: 'give_bebits',\n        patterns: [/* regex patterns for fallback */],\n        execute: async (match, context) => {\n            const target = match[1];\n            const amount = parseInt(match[2]);\n            await addBebits(target, amount);\n            return { success: true, message: `Gave ${amount} bebits to <@${target}>!` };\n        }\n    },\n    // ... more commands\n};"}],"\n",["$","hr",null,{}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"server-memory-services","children":["$","a",null,{"href":"#server-memory-services","className":"anchor-link","children":"Server Memory Services"}]}],"\n",["$","p",null,{"children":"The server memory system consists of four services that work together."}],"\n",["$","h3",null,{"id":"messageingestionjs","children":["$","a",null,{"href":"#messageingestionjs","className":"anchor-link","children":"messageIngestion.js"}]}],"\n",["$","p",null,{"children":"Captures ALL server messages for server-wide memory."}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Key exports\nexport async function ingestMessage(discordMessage)    // Store raw message\nexport function calculateImportanceScore(message)       // Score 0-1\nexport function shouldEmbed(score, threshold)          // Check threshold"}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":"Importance Factors"}],":"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Content length (0.15), Questions (0.20), Mentions (0.15)"}],"\n",["$","li",null,{"children":"Topic keywords (0.15), Emotional intensity (0.10)"}],"\n",["$","li",null,{"children":"Breaking silence (0.10), Attachments (0.05)"}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"id":"embeddingqueuejs","children":["$","a",null,{"href":"#embeddingqueuejs","className":"anchor-link","children":"embeddingQueue.js"}]}],"\n",["$","p",null,{"children":"Background batch processing for embeddings."}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Key exports\nexport function startProcessor()      // Start background processing\nexport function stopProcessor()       // Stop processor\nexport function getQueueStats()       // Get pending/completed/failed counts\nexport function bufferToEmbedding()   // Convert BLOB to array"}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":"Configuration"}],":"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Batch size: 10 messages"}],"\n",["$","li",null,{"children":"Interval: 30 seconds"}],"\n",["$","li",null,{"children":"Max retries: 3"}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"id":"servermemoryjs","children":["$","a",null,{"href":"#servermemoryjs","className":"anchor-link","children":"serverMemory.js"}]}],"\n",["$","p",null,{"children":"Retrieval API for server-wide memories."}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Key exports\nexport async function getAmbientContext(guildId, channelId, options)\nexport async function searchServerMemories(query, options)\nexport function getActiveTopics(guildId, limit)\nexport async function buildServerMemoryContext(guildId, channelId, query, userId)"}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":"Retrieval Modes"}],":"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"ambient"}],": Recent activity awareness"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"deep"}],": Semantic search for specific details"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"topic_track"}],": Ongoing discussions"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"id":"summarizerjs","children":["$","a",null,{"href":"#summarizerjs","className":"anchor-link","children":"summarizer.js"}]}],"\n",["$","p",null,{"children":"Periodic channel summarization."}],"\n",["$","$Lf",null,{"language":"javascript","children":"// Key exports\nexport function startScheduler(guildId)        // Start hourly/daily jobs\nexport function stopScheduler()                // Stop all jobs\nexport async function runHourlySummaries()     // Manual hourly run\nexport async function runDailySummaries()      // Manual daily run\nexport async function triggerSummary()         // Manual single summary"}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":"Schedule"}],":"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Hourly: Top of each hour (channels with 5+ messages)"}],"\n",["$","li",null,{"children":"Daily: 2:00 AM (channels with 20+ messages)"}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"service-dependencies","children":["$","a",null,{"href":"#service-dependencies","className":"anchor-link","children":"Service Dependencies"}]}],"\n",["$","$Lf",null,{"language":"$undefined","children":"database.js              openrouter.js\n(standalone)             (standalone)\n    ↑                        ↑\n    │                        │\n    └────────┬───────────────┘\n             │\n        llmEvaluator.js\n        (rate limiting, caching)\n             ↑\n    ┌────────┼────────┐\n    │        │        │\n    ↓        ↓        ↓\nmemory.js  personality.js  adminCommands.js\n    ↑           ↑              ↑\n    │           │              │\n    └─────┬─────┘              │\n          │                    │\n       chat.js ────────────────┘"}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Key dependency changes:"}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"llmEvaluator.js"}]," depends on ",["$","code",null,{"children":"openrouter.js"}]," for API calls"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"personality.js"}]," now imports ",["$","code",null,{"children":"evaluateMood"}]," and ",["$","code",null,{"children":"evaluateRelationship"}]," from ",["$","code",null,{"children":"llmEvaluator.js"}]]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"adminCommands.js"}]," now imports ",["$","code",null,{"children":"parseJarvisIntent"}]," from ",["$","code",null,{"children":"llmEvaluator.js"}]]}],"\n"]}],"\n",["$","h2",null,{"id":"best-practices","children":["$","a",null,{"href":"#best-practices","className":"anchor-link","children":"Best Practices"}]}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Keep services focused"}]," - One responsibility per module"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Avoid circular dependencies"}]," - Use dependency injection if needed"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Handle errors gracefully"}]," - Return meaningful error objects"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Log important operations"}]," - For debugging and monitoring"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Use transactions"}]," - For multi-table operations"]}],"\n"]}]]
