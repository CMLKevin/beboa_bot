<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/443896d591e4f761-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/3cf59f0fd0496c15.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-e5714bf66625afb9.js"/><script src="/_next/static/chunks/fd9d1056-e1b8fc02af805f43.js" async=""></script><script src="/_next/static/chunks/117-bf803eaaef7a29e0.js" async=""></script><script src="/_next/static/chunks/main-app-b6379442ececfbb8.js" async=""></script><script src="/_next/static/chunks/972-68a674eeca97bbbb.js" async=""></script><script src="/_next/static/chunks/646-1e67c3e800eb58dd.js" async=""></script><script src="/_next/static/chunks/app/layout-4b75b78215e64ea2.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js" async=""></script><title>Services - Beboa Docs</title><meta name="description" content="Deep dive into the service layer modules and business logic."/><link rel="icon" href="/favicon.ico"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_f367f3 __variable_a06722 font-sans"><div style="visibility:hidden"><div class="min-h-screen bg-[var(--bg-primary)] transition-colors duration-200"><header class="sticky top-0 z-40 w-full h-[var(--header-height)] bg-[var(--bg-secondary)] border-b border-[var(--border)]"><div class="flex items-center justify-between h-full px-4 lg:px-6"><div class="flex items-center gap-6"><button class="lg:hidden p-2 -ml-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu w-5 h-5"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><a class="flex items-center gap-2 text-lg font-semibold text-[var(--text-primary)] hover:text-[var(--accent)] transition-colors" href="/"><span class="text-xl">ğŸ</span><span class="hidden sm:inline">Beboa</span><span class="hidden sm:inline text-xs font-normal text-[var(--text-muted)] ml-1">Docs</span></a><nav class="hidden lg:flex items-center gap-1"><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/">User Guide</a><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/">AI Systems</a><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/">Jarvis Mode</a><a class="px-3 py-2 text-sm font-medium rounded-md transition-colors text-[var(--accent)] bg-[var(--accent-light)]" href="/architecture/structure/">Reference</a></nav></div><div class="flex items-center gap-3"><div class="hidden sm:block"><button class="flex items-center gap-2 px-3 py-2 text-sm text-[var(--text-muted)] bg-[var(--bg-tertiary)] hover:bg-[var(--border)] rounded-lg border border-[var(--border)] transition-colors w-full max-w-[240px]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search w-4 h-4"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><span class="flex-1 text-left">Search docs...</span><kbd class="hidden sm:inline-flex items-center gap-0.5 px-1.5 py-0.5 text-xs font-medium text-[var(--text-muted)] bg-[var(--bg-secondary)] rounded border border-[var(--border)]"><span class="text-xs">âŒ˜</span>K</kbd></button></div><button class="sm:hidden p-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Search"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button><a href="https://github.com/CMLKevin/beboa_evo" target="_blank" rel="noopener noreferrer" class="hidden sm:flex p-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github w-5 h-5"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></a><button class="p-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Switch to dark mode"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon w-5 h-5"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg></button></div></div></header><aside class="fixed inset-y-0 left-0 z-50 w-72 bg-[var(--bg-secondary)] border-r border-[var(--border)] transform transition-transform duration-300 ease-in-out lg:hidden -translate-x-full"><div class="flex items-center justify-between h-[var(--header-height)] px-4 border-b border-[var(--border)]"><a class="flex items-center gap-2 text-lg font-semibold text-[var(--text-primary)]" href="/"><span class="text-xl">ğŸ</span><span>Beboa</span></a><button class="p-2 -mr-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors" aria-label="Close menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x w-5 h-5"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button></div><div class="p-4 border-b border-[var(--border)]"><div class="flex flex-wrap gap-2"><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-tertiary)]" href="/">User Guide</a><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-tertiary)]" href="/ai/">AI Systems</a><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-tertiary)]" href="/jarvis/">Jarvis Mode</a><a class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-[var(--accent)] bg-[var(--accent-light)]" href="/architecture/structure/">Reference</a></div></div><nav class="overflow-y-auto h-[calc(100%-128px)] py-4 px-4"><ul class="space-y-1"><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Getting Started</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/">Home</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/getting-started/installation/">Installation</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/getting-started/configuration/">Configuration</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/getting-started/quickstart/">Quick Start</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Features</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/">Overview</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/checkins/">Daily Check-ins</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/bebits/">Bebits &amp; Rewards</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/features/chat/">AI Chat</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">AI Systems</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/">Overview</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/personality/">Dynamic Personality</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/moods/">Mood System</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/relationships/">Relationships</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/memory/">Semantic Memory</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/llm-evaluator/">LLM Evaluator</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/ai/tools/">Tool Calls</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Jarvis Mode 2.0</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/">Overview</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/commands/">Commands Reference</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/parsing/">Intent Parsing</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/jarvis/fun/">Fun Commands</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Commands</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/commands/user/">User Commands</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/commands/admin/">Admin Commands</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Architecture</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/structure/">Project Structure</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/database/">Database Schema</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--accent)] bg-[var(--accent-light)] font-medium" href="/architecture/services/">Services</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/flow/">Message Flow</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Developer Guide</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/commands/">Extending Commands</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/tools/">Custom Tools</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/migrations/">Database Migrations</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/api/">API Reference</a></li></ul></li><li class="mb-4"><div class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Deployment</div><ul class="mt-1 space-y-1"><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/railway/">Railway</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/vps/">VPS Setup</a></li><li><a class="block px-3 py-2 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/docker/">Docker</a></li></ul></li></ul></nav></aside><div class="flex"><aside class="hidden lg:block fixed top-[var(--header-height)] left-0 bottom-0 w-[var(--sidebar-width)] border-r border-[var(--border)] bg-[var(--bg-secondary)] overflow-y-auto"><nav class="py-6 px-4"><ul class="space-y-6"><li><div class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Architecture</div><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/structure/">Project Structure</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/database/">Database Schema</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/services/">Services</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/architecture/flow/">Message Flow</a></li></ul></li><li><div class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Developer Guide</div><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/commands/">Extending Commands</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/tools/">Custom Tools</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/migrations/">Database Migrations</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/dev/api/">API Reference</a></li></ul></li><li><div class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-[var(--text-muted)]">Deployment</div><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/railway/">Railway</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/vps/">VPS Setup</a></li><li><a class="block px-3 py-1.5 rounded-md text-sm transition-colors text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]" href="/deployment/docker/">Docker</a></li></ul></li></ul></nav></aside><main class="flex-1 min-w-0 lg:pl-[var(--sidebar-width)]"><div class="max-w-[var(--content-max-width)] mx-auto px-6 py-8 lg:px-8 lg:py-12"><article class="animate-in"><div class="flex items-start justify-between gap-4 mb-6"><nav aria-label="Breadcrumb" class="flex items-center gap-1.5 text-sm mb-4"><div class="flex items-center gap-1.5"><a class="text-[var(--text-muted)] hover:text-[var(--text-primary)] transition-colors" href="/architecture/structure/">Architecture</a></div></nav><button class="flex items-center gap-1.5 px-3 py-1.5 text-sm text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)] rounded-md transition-colors border border-transparent hover:border-[var(--border)]" title="Copy page content"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-4 h-4"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy page</span></button></div><h1>Services</h1><p class="text-lg text-[var(--text-secondary)] mb-8 -mt-2">Deep dive into the service layer modules and business logic.</p><div class="prose-custom"><h1 id="services-architecture">Services Architecture</h1>
<p>Deep dive into the service layer modules.</p>
<h2 id="overview"><a href="#overview" class="anchor-link">Overview</a></h2>
<p>Services contain business logic, separated from Discord event handling.</p>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="px-4"><span>â”‚                   Event Handlers                    â”‚</span></div><div class="px-4"><span>â”‚         (commands/, events/)                       â”‚</span></div><div class="px-4"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="px-4"><span>                         â”‚</span></div><div class="px-4"><span>                         â–¼</span></div><div class="px-4"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="px-4"><span>â”‚                   Services Layer                    â”‚</span></div><div class="px-4"><span>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚</span></div><div class="px-4"><span>â”‚  â”‚ database â”‚ â”‚openrouterâ”‚ â”‚   chat   â”‚           â”‚</span></div><div class="px-4"><span>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚</span></div><div class="px-4"><span>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚</span></div><div class="px-4"><span>â”‚  â”‚  memory  â”‚ â”‚personalityâ”‚ â”‚  tools   â”‚           â”‚</span></div><div class="px-4"><span>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚</span></div><div class="px-4"><span>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚</span></div><div class="px-4"><span>â”‚  â”‚   llmEvaluator     â”‚ â”‚   adminCommands    â”‚    â”‚</span></div><div class="px-4"><span>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚</span></div><div class="px-4"><span>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span></div><div class="px-4"><span>â”‚  â”‚         Server Memory Services              â”‚   â”‚</span></div><div class="px-4"><span>â”‚  â”‚  messageIngestion | embeddingQueue          â”‚   â”‚</span></div><div class="px-4"><span>â”‚  â”‚  serverMemory     | summarizer              â”‚   â”‚</span></div><div class="px-4"><span>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span></div><div class="px-4"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<h2 id="databasejs"><a href="#databasejs" class="anchor-link">database.js</a></h2>
<p>SQLite database operations.</p>
<h3 id="key-functions"><a href="#key-functions" class="anchor-link">Key Functions</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// User operations</span></div><div class="px-4"><span>export function getUser(userId)</span></div><div class="px-4"><span>export function createUser(userId, username)</span></div><div class="px-4"><span>export function updateUser(userId, data)</span></div><div class="px-4"><span>export function deleteUser(userId)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Bebits operations</span></div><div class="px-4"><span>export function addBebits(userId, amount)</span></div><div class="px-4"><span>export function removeBebits(userId, amount)</span></div><div class="px-4"><span>export function setBebits(userId, amount)</span></div><div class="px-4"><span>export function transferBebits(fromId, toId, amount)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Check-in operations</span></div><div class="px-4"><span>export function performCheckin(userId)</span></div><div class="px-4"><span>export function getStreak(userId)</span></div><div class="px-4"><span>export function resetStreak(userId)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Leaderboard</span></div><div class="px-4"><span>export function getLeaderboard(limit = 10)</span></div><div class="px-4"><span>export function getUserRank(userId)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Relationships</span></div><div class="px-4"><span>export function getRelationship(userId)</span></div><div class="px-4"><span>export function updateTrust(userId, delta)</span></div><div class="px-4"><span>export function setRelationshipStage(userId, stage)</span></div></code></pre></div>
<h3 id="connection-management"><a href="#connection-management" class="anchor-link">Connection Management</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>import Database from &#x27;better-sqlite3&#x27;;</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>const db = new Database(&#x27;data/beboa.db&#x27;);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Enable WAL mode for better concurrency</span></div><div class="px-4"><span>db.pragma(&#x27;journal_mode = WAL&#x27;);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Graceful shutdown</span></div><div class="px-4"><span>process.on(&#x27;exit&#x27;, () =&gt; db.close());</span></div></code></pre></div>
<hr/>
<h2 id="openrouterjs"><a href="#openrouterjs" class="anchor-link">openrouter.js</a></h2>
<p>OpenRouter API client.</p>
<h3 id="key-functions-1"><a href="#key-functions-1" class="anchor-link">Key Functions</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Chat completion</span></div><div class="px-4"><span>export async function generateResponse(messages, options = {})</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Embeddings</span></div><div class="px-4"><span>export async function generateEmbedding(text)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Image generation</span></div><div class="px-4"><span>export async function generateImage(prompt, options = {})</span></div></code></pre></div>
<h3 id="api-call-structure"><a href="#api-call-structure" class="anchor-link">API Call Structure</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>export async function generateResponse(messages, options = {}) {</span></div><div class="px-4"><span>    const response = await fetch(&#x27;https://openrouter.ai/api/v1/chat/completions&#x27;, {</span></div><div class="px-4"><span>        method: &#x27;POST&#x27;,</span></div><div class="px-4"><span>        headers: {</span></div><div class="px-4"><span>            &#x27;Authorization&#x27;: `Bearer ${process.env.OPENROUTER_API_KEY}`,</span></div><div class="px-4"><span>            &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,</span></div><div class="px-4"><span>            &#x27;HTTP-Referer&#x27;: &#x27;https://github.com/CMLKevin/beboa_evo&#x27;,</span></div><div class="px-4"><span>            &#x27;X-Title&#x27;: &#x27;Beboa Discord Bot&#x27;</span></div><div class="px-4"><span>        },</span></div><div class="px-4"><span>        body: JSON.stringify({</span></div><div class="px-4"><span>            model: options.model || process.env.OPENROUTER_MODEL,</span></div><div class="px-4"><span>            messages,</span></div><div class="px-4"><span>            max_tokens: options.maxTokens || parseInt(process.env.OPENROUTER_MAX_TOKENS),</span></div><div class="px-4"><span>            temperature: options.temperature || parseFloat(process.env.OPENROUTER_TEMPERATURE),</span></div><div class="px-4"><span>            tools: options.tools || undefined</span></div><div class="px-4"><span>        })</span></div><div class="px-4"><span>    });</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    return response.json();</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<hr/>
<h2 id="chatjs"><a href="#chatjs" class="anchor-link">chat.js</a></h2>
<p>Chat processing and context management.</p>
<h3 id="key-functions-2"><a href="#key-functions-2" class="anchor-link">Key Functions</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Main chat handler</span></div><div class="px-4"><span>export async function handleChat(message, context = {})</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Context building</span></div><div class="px-4"><span>export async function buildContext(userId, channelId)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// History management</span></div><div class="px-4"><span>export function addToHistory(userId, role, content)</span></div><div class="px-4"><span>export function getHistory(userId, limit)</span></div><div class="px-4"><span>export function clearHistory(userId)</span></div></code></pre></div>
<h3 id="chat-processing-flow"><a href="#chat-processing-flow" class="anchor-link">Chat Processing Flow</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>export async function handleChat(message, context = {}) {</span></div><div class="px-4"><span>    const userId = message.author.id;</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 1. Check cooldown</span></div><div class="px-4"><span>    if (isOnCooldown(userId)) {</span></div><div class="px-4"><span>        return message.reply(&quot;Slow down!&quot;);</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 2. Build context</span></div><div class="px-4"><span>    const chatContext = await buildContext(userId, message.channel.id);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 3. Get personality/mood</span></div><div class="px-4"><span>    const personality = await getPersonality();</span></div><div class="px-4"><span>    const mood = await getCurrentMood();</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 4. Retrieve relevant memories</span></div><div class="px-4"><span>    const memories = await searchMemories(userId, message.content, 5);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 5. Build messages array</span></div><div class="px-4"><span>    const messages = [</span></div><div class="px-4"><span>        { role: &#x27;system&#x27;, content: buildSystemPrompt(personality, mood, memories) },</span></div><div class="px-4"><span>        ...chatContext.history,</span></div><div class="px-4"><span>        { role: &#x27;user&#x27;, content: message.content }</span></div><div class="px-4"><span>    ];</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 6. Generate response</span></div><div class="px-4"><span>    const response = await generateResponse(messages, {</span></div><div class="px-4"><span>        tools: getEnabledTools()</span></div><div class="px-4"><span>    });</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 7. Handle tool calls if present</span></div><div class="px-4"><span>    if (response.choices[0].message.tool_calls) {</span></div><div class="px-4"><span>        await handleToolCalls(response, message);</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 8. Send response</span></div><div class="px-4"><span>    await message.reply(response.choices[0].message.content);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // 9. Post-process (memory extraction, mood update)</span></div><div class="px-4"><span>    await postProcess(userId, message.content, response);</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<hr/>
<h2 id="memoryjs"><a href="#memoryjs" class="anchor-link">memory.js</a></h2>
<p>Semantic memory system.</p>
<h3 id="key-functions-3"><a href="#key-functions-3" class="anchor-link">Key Functions</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Memory CRUD</span></div><div class="px-4"><span>export async function addMemory(userId, content, type, importance)</span></div><div class="px-4"><span>export async function getMemories(userId, limit)</span></div><div class="px-4"><span>export async function searchMemories(userId, query, limit)</span></div><div class="px-4"><span>export async function deleteMemory(memoryId)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Embedding operations</span></div><div class="px-4"><span>export async function generateEmbedding(text)</span></div><div class="px-4"><span>export function cosineSimilarity(a, b)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Auto-extraction</span></div><div class="px-4"><span>export async function extractMemories(userId, conversation)</span></div></code></pre></div>
<h3 id="semantic-search"><a href="#semantic-search" class="anchor-link">Semantic Search</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>export async function searchMemories(userId, query, limit = 5) {</span></div><div class="px-4"><span>    // Generate query embedding</span></div><div class="px-4"><span>    const queryEmbedding = await generateEmbedding(query);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Get all user memories</span></div><div class="px-4"><span>    const memories = db.prepare(`</span></div><div class="px-4"><span>        SELECT * FROM memories</span></div><div class="px-4"><span>        WHERE user_id = ?</span></div><div class="px-4"><span>    `).all(userId);</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Compute similarities</span></div><div class="px-4"><span>    const scored = memories.map(memory =&gt; ({</span></div><div class="px-4"><span>        ...memory,</span></div><div class="px-4"><span>        embedding: deserializeEmbedding(memory.embedding),</span></div><div class="px-4"><span>        similarity: cosineSimilarity(queryEmbedding, deserializeEmbedding(memory.embedding))</span></div><div class="px-4"><span>    }));</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Filter and sort</span></div><div class="px-4"><span>    return scored</span></div><div class="px-4"><span>        .filter(m =&gt; m.similarity &gt;= 0.7)</span></div><div class="px-4"><span>        .sort((a, b) =&gt; b.similarity - a.similarity)</span></div><div class="px-4"><span>        .slice(0, limit);</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<hr/>
<h2 id="personalityjs"><a href="#personalityjs" class="anchor-link">personality.js</a></h2>
<p>Personality and mood management.</p>
<h3 id="key-functions-4"><a href="#key-functions-4" class="anchor-link">Key Functions</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Personality</span></div><div class="px-4"><span>export async function getPersonality()</span></div><div class="px-4"><span>export async function updateTrait(trait, value)</span></div><div class="px-4"><span>export async function resetPersonality()</span></div><div class="px-4"><span>export async function evolveTrait(trait, delta)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Mood</span></div><div class="px-4"><span>export async function getCurrentMood()</span></div><div class="px-4"><span>export async function setMood(mood, intensity)</span></div><div class="px-4"><span>export async function shiftMood(mood, amount)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Relationships</span></div><div class="px-4"><span>export async function getRelationshipStage(userId)</span></div><div class="px-4"><span>export async function updateRelationship(userId, interaction)</span></div></code></pre></div>
<h3 id="trait-evolution"><a href="#trait-evolution" class="anchor-link">Trait Evolution</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>export async function evolveTrait(trait, delta) {</span></div><div class="px-4"><span>    const current = await getPersonality();</span></div><div class="px-4"><span>    let newValue = current[trait] + delta;</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    // Clamp between 0.1 and 0.9</span></div><div class="px-4"><span>    newValue = Math.max(0.1, Math.min(0.9, newValue));</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    db.prepare(`</span></div><div class="px-4"><span>        UPDATE personality SET ${trait} = ?, last_updated = ?</span></div><div class="px-4"><span>        WHERE id = 1</span></div><div class="px-4"><span>    `).run(newValue, new Date().toISOString());</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>    return newValue;</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<hr/>
<h2 id="toolsjs"><a href="#toolsjs" class="anchor-link">tools.js</a></h2>
<p>Tool call framework.</p>
<h3 id="key-functions-5"><a href="#key-functions-5" class="anchor-link">Key Functions</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Tool definitions</span></div><div class="px-4"><span>export function getToolDefinitions()</span></div><div class="px-4"><span>export function getEnabledTools()</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Tool execution</span></div><div class="px-4"><span>export async function executeToolCall(name, args)</span></div><div class="px-4"><span>export async function handleToolCalls(response, message)</span></div></code></pre></div>
<h3 id="tool-registry"><a href="#tool-registry" class="anchor-link">Tool Registry</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>const toolRegistry = {</span></div><div class="px-4"><span>    generate_image: {</span></div><div class="px-4"><span>        definition: { /* JSON Schema */ },</span></div><div class="px-4"><span>        handler: handleImageGeneration,</span></div><div class="px-4"><span>        enabled: () =&gt; process.env.IMAGE_GEN_ENABLED === &#x27;true&#x27;</span></div><div class="px-4"><span>    },</span></div><div class="px-4"><span>    roll_dice: {</span></div><div class="px-4"><span>        definition: { /* JSON Schema */ },</span></div><div class="px-4"><span>        handler: handleDiceRoll,</span></div><div class="px-4"><span>        enabled: () =&gt; true</span></div><div class="px-4"><span>    }</span></div><div class="px-4"><span>    // Add more tools here</span></div><div class="px-4"><span>};</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>export function getEnabledTools() {</span></div><div class="px-4"><span>    return Object.values(toolRegistry)</span></div><div class="px-4"><span>        .filter(tool =&gt; tool.enabled())</span></div><div class="px-4"><span>        .map(tool =&gt; tool.definition);</span></div><div class="px-4"><span>}</span></div></code></pre></div>
<hr/>
<h2 id="llmevaluatorjs"><a href="#llmevaluatorjs" class="anchor-link">llmEvaluator.js</a></h2>
<p><strong>NEW</strong> - Centralized LLM-powered evaluation service.</p>
<h3 id="key-functions-6"><a href="#key-functions-6" class="anchor-link">Key Functions</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Mood evaluation</span></div><div class="px-4"><span>export async function evaluateMood(message, context)</span></div><div class="px-4"><span>// Returns: { sentiment, suggestedMood, moodConfidence, detectedPatterns, ... }</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Relationship evaluation</span></div><div class="px-4"><span>export async function evaluateRelationship(userMessage, botResponse, context)</span></div><div class="px-4"><span>// Returns: { interactionQuality, trustIndicators, relationshipDeltas, ... }</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Jarvis intent parsing</span></div><div class="px-4"><span>export async function parseJarvisIntent(message, context)</span></div><div class="px-4"><span>// Returns: { isCommand, command, confidence, params, requiresConfirmation, ... }</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Utilities</span></div><div class="px-4"><span>export function isAvailable()      // Check if evaluator can be called</span></div><div class="px-4"><span>export function getCacheStats()    // Cache and rate limit stats</span></div><div class="px-4"><span>export function clearCache()       // Clear response cache</span></div></code></pre></div>
<h3 id="configuration"><a href="#configuration" class="anchor-link">Configuration</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>const EVALUATOR_MODEL = config.LLM_EVALUATOR_MODEL || &#x27;x-ai/grok-4.1-fast&#x27;;</span></div><div class="px-4"><span>const CACHE_TTL = config.LLM_EVALUATOR_CACHE_TTL || 60000;</span></div><div class="px-4"><span>const RATE_LIMIT_CALLS = config.LLM_EVALUATOR_RATE_LIMIT || 30;</span></div></code></pre></div>
<h3 id="features"><a href="#features" class="anchor-link">Features</a></h3>
<ul>
<li><strong>Rate limiting</strong>: 30 calls/minute with queue</li>
<li><strong>Response caching</strong>: 60s TTL on content hash</li>
<li><strong>Graceful fallback</strong>: Returns <code>null</code> to signal fallback needed</li>
<li><strong>Deterministic</strong>: Temperature 0.1 for consistent evaluations</li>
</ul>
<hr/>
<h2 id="admincommandsjs"><a href="#admincommandsjs" class="anchor-link">adminCommands.js</a></h2>
<p>Jarvis Mode implementation with LLM-first parsing.</p>
<h3 id="key-functions-7"><a href="#key-functions-7" class="anchor-link">Key Functions</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Main entry point (now LLM-first)</span></div><div class="px-4"><span>export async function parseAndExecuteAdminCommand(message, context)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// LLM execution</span></div><div class="px-4"><span>async function executeFromLLMIntent(llmIntent, originalMessage, context)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Fallback parsing</span></div><div class="px-4"><span>export function tryPatternMatch(message)</span></div><div class="px-4"><span>export function analyzeIntent(message)</span></div><div class="px-4"><span>export function extractEntities(message)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Command execution</span></div><div class="px-4"><span>export async function executeCommand(command, params, context)</span></div><div class="px-4"><span> </span></div><div class="px-4"><span>// Utilities</span></div><div class="px-4"><span>export function getAvailableAdminCommands()</span></div><div class="px-4"><span>export function isConfirmationPending(userId)</span></div></code></pre></div>
<h3 id="parsing-pipeline"><a href="#parsing-pipeline" class="anchor-link">Parsing Pipeline</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Stage 1: Check pending confirmations</span></div><div class="px-4"><span>// Stage 2: LLM Intent Parser (PRIMARY)</span></div><div class="px-4"><span>// Stage 3: Pattern Matching (FALLBACK)</span></div><div class="px-4"><span>// Stage 4: Intent Keywords (FALLBACK)</span></div><div class="px-4"><span>// Stage 5: Context Substitution</span></div></code></pre></div>
<h3 id="command-registration"><a href="#command-registration" class="anchor-link">Command Registration</a></h3>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>const commands = {</span></div><div class="px-4"><span>    give_bebits: {</span></div><div class="px-4"><span>        name: &#x27;give_bebits&#x27;,</span></div><div class="px-4"><span>        patterns: [/* regex patterns for fallback */],</span></div><div class="px-4"><span>        execute: async (match, context) =&gt; {</span></div><div class="px-4"><span>            const target = match[1];</span></div><div class="px-4"><span>            const amount = parseInt(match[2]);</span></div><div class="px-4"><span>            await addBebits(target, amount);</span></div><div class="px-4"><span>            return { success: true, message: `Gave ${amount} bebits to &lt;@${target}&gt;!` };</span></div><div class="px-4"><span>        }</span></div><div class="px-4"><span>    },</span></div><div class="px-4"><span>    // ... more commands</span></div><div class="px-4"><span>};</span></div></code></pre></div>
<hr/>
<hr/>
<h2 id="server-memory-services"><a href="#server-memory-services" class="anchor-link">Server Memory Services</a></h2>
<p>The server memory system consists of four services that work together.</p>
<h3 id="messageingestionjs"><a href="#messageingestionjs" class="anchor-link">messageIngestion.js</a></h3>
<p>Captures ALL server messages for server-wide memory.</p>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Key exports</span></div><div class="px-4"><span>export async function ingestMessage(discordMessage)    // Store raw message</span></div><div class="px-4"><span>export function calculateImportanceScore(message)       // Score 0-1</span></div><div class="px-4"><span>export function shouldEmbed(score, threshold)          // Check threshold</span></div></code></pre></div>
<p><strong>Importance Factors</strong>:</p>
<ul>
<li>Content length (0.15), Questions (0.20), Mentions (0.15)</li>
<li>Topic keywords (0.15), Emotional intensity (0.10)</li>
<li>Breaking silence (0.10), Attachments (0.05)</li>
</ul>
<hr/>
<h3 id="embeddingqueuejs"><a href="#embeddingqueuejs" class="anchor-link">embeddingQueue.js</a></h3>
<p>Background batch processing for embeddings.</p>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Key exports</span></div><div class="px-4"><span>export function startProcessor()      // Start background processing</span></div><div class="px-4"><span>export function stopProcessor()       // Stop processor</span></div><div class="px-4"><span>export function getQueueStats()       // Get pending/completed/failed counts</span></div><div class="px-4"><span>export function bufferToEmbedding()   // Convert BLOB to array</span></div></code></pre></div>
<p><strong>Configuration</strong>:</p>
<ul>
<li>Batch size: 10 messages</li>
<li>Interval: 30 seconds</li>
<li>Max retries: 3</li>
</ul>
<hr/>
<h3 id="servermemoryjs"><a href="#servermemoryjs" class="anchor-link">serverMemory.js</a></h3>
<p>Retrieval API for server-wide memories.</p>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Key exports</span></div><div class="px-4"><span>export async function getAmbientContext(guildId, channelId, options)</span></div><div class="px-4"><span>export async function searchServerMemories(query, options)</span></div><div class="px-4"><span>export function getActiveTopics(guildId, limit)</span></div><div class="px-4"><span>export async function buildServerMemoryContext(guildId, channelId, query, userId)</span></div></code></pre></div>
<p><strong>Retrieval Modes</strong>:</p>
<ul>
<li><code>ambient</code>: Recent activity awareness</li>
<li><code>deep</code>: Semantic search for specific details</li>
<li><code>topic_track</code>: Ongoing discussions</li>
</ul>
<hr/>
<h3 id="summarizerjs"><a href="#summarizerjs" class="anchor-link">summarizer.js</a></h3>
<p>Periodic channel summarization.</p>
<div class="relative group my-6"><div class="flex items-center justify-between px-4 py-2 bg-[#2d2d2d] dark:bg-[#1a1a1a] border-b border-[#3d3d3d] rounded-t-lg"><span class="text-xs font-medium text-[#9a9a9a]">javascript</span><button class="flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-b-lg rounded-t-none p-4"><code class="font-mono block"><div class="px-4"><span>// Key exports</span></div><div class="px-4"><span>export function startScheduler(guildId)        // Start hourly/daily jobs</span></div><div class="px-4"><span>export function stopScheduler()                // Stop all jobs</span></div><div class="px-4"><span>export async function runHourlySummaries()     // Manual hourly run</span></div><div class="px-4"><span>export async function runDailySummaries()      // Manual daily run</span></div><div class="px-4"><span>export async function triggerSummary()         // Manual single summary</span></div></code></pre></div>
<p><strong>Schedule</strong>:</p>
<ul>
<li>Hourly: Top of each hour (channels with 5+ messages)</li>
<li>Daily: 2:00 AM (channels with 20+ messages)</li>
</ul>
<hr/>
<h2 id="service-dependencies"><a href="#service-dependencies" class="anchor-link">Service Dependencies</a></h2>
<div class="relative group my-6"><pre class="overflow-x-auto text-sm bg-[var(--code-bg)] text-[var(--code-text)] rounded-lg p-4"><code class="font-mono block"><div class="px-4"><span>database.js              openrouter.js</span></div><div class="px-4"><span>(standalone)             (standalone)</span></div><div class="px-4"><span>    â†‘                        â†‘</span></div><div class="px-4"><span>    â”‚                        â”‚</span></div><div class="px-4"><span>    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="px-4"><span>             â”‚</span></div><div class="px-4"><span>        llmEvaluator.js</span></div><div class="px-4"><span>        (rate limiting, caching)</span></div><div class="px-4"><span>             â†‘</span></div><div class="px-4"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="px-4"><span>    â”‚        â”‚        â”‚</span></div><div class="px-4"><span>    â†“        â†“        â†“</span></div><div class="px-4"><span>memory.js  personality.js  adminCommands.js</span></div><div class="px-4"><span>    â†‘           â†‘              â†‘</span></div><div class="px-4"><span>    â”‚           â”‚              â”‚</span></div><div class="px-4"><span>    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚</span></div><div class="px-4"><span>          â”‚                    â”‚</span></div><div class="px-4"><span>       chat.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div></code></pre><button class="absolute top-3 right-3 flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded transition-all opacity-0 group-hover:opacity-100 bg-[#3d3d3d] text-[#9a9a9a] hover:bg-[#4d4d4d] hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-3.5 h-3.5"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div>
<p><strong>Key dependency changes:</strong></p>
<ul>
<li><code>llmEvaluator.js</code> depends on <code>openrouter.js</code> for API calls</li>
<li><code>personality.js</code> now imports <code>evaluateMood</code> and <code>evaluateRelationship</code> from <code>llmEvaluator.js</code></li>
<li><code>adminCommands.js</code> now imports <code>parseJarvisIntent</code> from <code>llmEvaluator.js</code></li>
</ul>
<h2 id="best-practices"><a href="#best-practices" class="anchor-link">Best Practices</a></h2>
<ol>
<li><strong>Keep services focused</strong> - One responsibility per module</li>
<li><strong>Avoid circular dependencies</strong> - Use dependency injection if needed</li>
<li><strong>Handle errors gracefully</strong> - Return meaningful error objects</li>
<li><strong>Log important operations</strong> - For debugging and monitoring</li>
<li><strong>Use transactions</strong> - For multi-table operations</li>
</ol></div><nav class="flex items-center justify-between mt-16 pt-8 border-t border-[var(--border)]"><a class="group flex items-center gap-2 px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)] hover:border-[var(--accent)] hover:shadow-soft transition-all" href="/architecture/database/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--accent)] transition-colors"><path d="m15 18-6-6 6-6"></path></svg><div class="text-left"><div class="text-xs text-[var(--text-muted)] mb-0.5">Previous</div><div class="text-sm font-medium text-[var(--text-primary)] group-hover:text-[var(--accent)] transition-colors">Database Schema</div></div></a><a class="group flex items-center gap-2 px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)] hover:border-[var(--accent)] hover:shadow-soft transition-all" href="/architecture/flow/"><div class="text-right"><div class="text-xs text-[var(--text-muted)] mb-0.5">Next</div><div class="text-sm font-medium text-[var(--text-primary)] group-hover:text-[var(--accent)] transition-colors">Message Flow</div></div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--accent)] transition-colors"><path d="m9 18 6-6-6-6"></path></svg></a></nav></article></div></main></div></div></div><script src="/_next/static/chunks/webpack-e5714bf66625afb9.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/443896d591e4f761-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/css/3cf59f0fd0496c15.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"4:I[2846,[],\"\"]\n7:I[4707,[],\"\"]\n9:I[6423,[],\"\"]\na:I[2060,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"185\",\"static/chunks/app/layout-4b75b78215e64ea2.js\"],\"ThemeProvider\"]\nb:I[4351,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"185\",\"static/chunks/app/layout-4b75b78215e64ea2.js\"],\"Header\"]\nc:I[9399,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"185\",\"static/chunks/app/layout-4b75b78215e64ea2.js\"],\"Sidebar\"]\ne:I[1060,[],\"\"]\n8:[\"slug\",\"architecture/services\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L4\",null,{\"buildId\":\"FeUt14WxB_Uw-6zJdn3nr\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"architecture\",\"services\",\"\"],\"initialTree\":[\"\",{\"children\":[[\"slug\",\"architecture/services\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"architecture\\\",\\\"services\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"architecture/services\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L5\",\"$L6\",null],null],null]},[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$8\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3cf59f0fd0496c15.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_f367f3 __variable_a06722 font-sans\",\"children\":[\"$\",\"$La\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-[var(--bg-primary)] transition-colors duration-200\",\"children\":[[\"$\",\"$Lb\",null,{}],[\"$\",\"div\",null,{\"className\":\"flex\",\"children\":[[\"$\",\"$Lc\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 min-w-0 lg:pl-[var(--sidebar-width)]\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-[var(--content-max-width)] mx-auto px-6 py-8 lg:px-8 lg:py-12\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}]}]]}]]}]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]\n"])</script><script>self.__next_f.push([1,"10:I[6430,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"Breadcrumbs\"]\n11:I[9078,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"CopyPageButton\"]\n13:I[3308,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"PageNavigation\"]\n14:I[5321,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"TableOfContents\"]\n6:[[\"$\",\"article\",null,{\"className\":\"animate-in\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-start justify-between gap-4 mb-6\",\"children\":[[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}],[\"$\",\"h1\",null,{\"children\":\"Services\"}],[\"$\",\"p\",null,{\"className\":\"text-lg text-[var(--text-secondary)] mb-8 -mt-2\",\"children\":\"Deep dive into the service layer modules and business logic.\"}],[\"$\",\"div\",null,{\"className\":\"prose-custom\",\"children\":\"$L12\"}],[\"$\",\"$L13\",null,{}]]}],[\"$\",\"$L14\",null,{}]]\nd:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Services - Beboa Docs\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Deep dive into the service layer modules and business logic.\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}],[\"$\",\"meta\",\"5\",{\"name\":\"next-size-adjust\"}]]\n5:null\n"])</script><script>self.__next_f.push([1,"15:I[5045,[\"972\",\"static/chunks/972-68a674eeca97bbbb.js\",\"646\",\"static/chunks/646-1e67c3e800eb58dd.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-ea4807ff1312ce17.js\"],\"CodeBlock\"]\n16:T95c,"])</script><script>self.__next_f.push([1,"â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   Event Handlers                    â”‚\nâ”‚         (commands/, events/)                       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                         â”‚\n                         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   Services Layer                    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚\nâ”‚  â”‚ database â”‚ â”‚openrouterâ”‚ â”‚   chat   â”‚           â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚\nâ”‚  â”‚  memory  â”‚ â”‚personalityâ”‚ â”‚  tools   â”‚           â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚   llmEvaluator     â”‚ â”‚   adminCommands    â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚         Server Memory Services              â”‚   â”‚\nâ”‚  â”‚  messageIngestion | embeddingQueue          â”‚   â”‚\nâ”‚  â”‚  serverMemory     | summarizer              â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"])</script><script>self.__next_f.push([1,"17:T4d4,export async function handleChat(message, context = {}) {\n    const userId = message.author.id;\n\n    // 1. Check cooldown\n    if (isOnCooldown(userId)) {\n        return message.reply(\"Slow down!\");\n    }\n\n    // 2. Build context\n    const chatContext = await buildContext(userId, message.channel.id);\n\n    // 3. Get personality/mood\n    const personality = await getPersonality();\n    const mood = await getCurrentMood();\n\n    // 4. Retrieve relevant memories\n    const memories = await searchMemories(userId, message.content, 5);\n\n    // 5. Build messages array\n    const messages = [\n        { role: 'system', content: buildSystemPrompt(personality, mood, memories) },\n        ...chatContext.history,\n        { role: 'user', content: message.content }\n    ];\n\n    // 6. Generate response\n    const response = await generateResponse(messages, {\n        tools: getEnabledTools()\n    });\n\n    // 7. Handle tool calls if present\n    if (response.choices[0].message.tool_calls) {\n        await handleToolCalls(response, message);\n    }\n\n    // 8. Send response\n    await message.reply(response.choices[0].message.content);\n\n    // 9. Post-process (memory extraction, mood update)\n    await postProcess(userId, message.content, response);\n}"])</script><script>self.__next_f.push([1,"12:[[\"$\",\"h1\",null,{\"id\":\"services-architecture\",\"children\":\"Services Architecture\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Deep dive into the service layer modules.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"overview\",\"children\":[\"$\",\"a\",null,{\"href\":\"#overview\",\"className\":\"anchor-link\",\"children\":\"Overview\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Services contain business logic, separated from Discord event handling.\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"$16\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"databasejs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#databasejs\",\"className\":\"anchor-link\",\"children\":\"database.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"SQLite database operations.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"key-functions\",\"children\":[\"$\",\"a\",null,{\"href\":\"#key-functions\",\"className\":\"anchor-link\",\"children\":\"Key Functions\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// User operations\\nexport function getUser(userId)\\nexport function createUser(userId, username)\\nexport function updateUser(userId, data)\\nexport function deleteUser(userId)\\n\\n// Bebits operations\\nexport function addBebits(userId, amount)\\nexport function removeBebits(userId, amount)\\nexport function setBebits(userId, amount)\\nexport function transferBebits(fromId, toId, amount)\\n\\n// Check-in operations\\nexport function performCheckin(userId)\\nexport function getStreak(userId)\\nexport function resetStreak(userId)\\n\\n// Leaderboard\\nexport function getLeaderboard(limit = 10)\\nexport function getUserRank(userId)\\n\\n// Relationships\\nexport function getRelationship(userId)\\nexport function updateTrust(userId, delta)\\nexport function setRelationshipStage(userId, stage)\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"connection-management\",\"children\":[\"$\",\"a\",null,{\"href\":\"#connection-management\",\"className\":\"anchor-link\",\"children\":\"Connection Management\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"import Database from 'better-sqlite3';\\n\\nconst db = new Database('data/beboa.db');\\n\\n// Enable WAL mode for better concurrency\\ndb.pragma('journal_mode = WAL');\\n\\n// Graceful shutdown\\nprocess.on('exit', () =\u003e db.close());\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"openrouterjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#openrouterjs\",\"className\":\"anchor-link\",\"children\":\"openrouter.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"OpenRouter API client.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"key-functions-1\",\"children\":[\"$\",\"a\",null,{\"href\":\"#key-functions-1\",\"className\":\"anchor-link\",\"children\":\"Key Functions\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Chat completion\\nexport async function generateResponse(messages, options = {})\\n\\n// Embeddings\\nexport async function generateEmbedding(text)\\n\\n// Image generation\\nexport async function generateImage(prompt, options = {})\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"api-call-structure\",\"children\":[\"$\",\"a\",null,{\"href\":\"#api-call-structure\",\"className\":\"anchor-link\",\"children\":\"API Call Structure\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"export async function generateResponse(messages, options = {}) {\\n    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\\n        method: 'POST',\\n        headers: {\\n            'Authorization': `Bearer ${process.env.OPENROUTER_API_KEY}`,\\n            'Content-Type': 'application/json',\\n            'HTTP-Referer': 'https://github.com/CMLKevin/beboa_evo',\\n            'X-Title': 'Beboa Discord Bot'\\n        },\\n        body: JSON.stringify({\\n            model: options.model || process.env.OPENROUTER_MODEL,\\n            messages,\\n            max_tokens: options.maxTokens || parseInt(process.env.OPENROUTER_MAX_TOKENS),\\n            temperature: options.temperature || parseFloat(process.env.OPENROUTER_TEMPERATURE),\\n            tools: options.tools || undefined\\n        })\\n    });\\n\\n    return response.json();\\n}\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"chatjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#chatjs\",\"className\":\"anchor-link\",\"children\":\"chat.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Chat processing and context management.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"key-functions-2\",\"children\":[\"$\",\"a\",null,{\"href\":\"#key-functions-2\",\"className\":\"anchor-link\",\"children\":\"Key Functions\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Main chat handler\\nexport async function handleChat(message, context = {})\\n\\n// Context building\\nexport async function buildContext(userId, channelId)\\n\\n// History management\\nexport function addToHistory(userId, role, content)\\nexport function getHistory(userId, limit)\\nexport function clearHistory(userId)\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"chat-processing-flow\",\"children\":[\"$\",\"a\",null,{\"href\":\"#chat-processing-flow\",\"className\":\"anchor-link\",\"children\":\"Chat Processing Flow\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"$17\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"memoryjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#memoryjs\",\"className\":\"anchor-link\",\"children\":\"memory.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Semantic memory system.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"key-functions-3\",\"children\":[\"$\",\"a\",null,{\"href\":\"#key-functions-3\",\"className\":\"anchor-link\",\"children\":\"Key Functions\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Memory CRUD\\nexport async function addMemory(userId, content, type, importance)\\nexport async function getMemories(userId, limit)\\nexport async function searchMemories(userId, query, limit)\\nexport async function deleteMemory(memoryId)\\n\\n// Embedding operations\\nexport async function generateEmbedding(text)\\nexport function cosineSimilarity(a, b)\\n\\n// Auto-extraction\\nexport async function extractMemories(userId, conversation)\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"semantic-search\",\"children\":[\"$\",\"a\",null,{\"href\":\"#semantic-search\",\"className\":\"anchor-link\",\"children\":\"Semantic Search\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"export async function searchMemories(userId, query, limit = 5) {\\n    // Generate query embedding\\n    const queryEmbedding = await generateEmbedding(query);\\n\\n    // Get all user memories\\n    const memories = db.prepare(`\\n        SELECT * FROM memories\\n        WHERE user_id = ?\\n    `).all(userId);\\n\\n    // Compute similarities\\n    const scored = memories.map(memory =\u003e ({\\n        ...memory,\\n        embedding: deserializeEmbedding(memory.embedding),\\n        similarity: cosineSimilarity(queryEmbedding, deserializeEmbedding(memory.embedding))\\n    }));\\n\\n    // Filter and sort\\n    return scored\\n        .filter(m =\u003e m.similarity \u003e= 0.7)\\n        .sort((a, b) =\u003e b.similarity - a.similarity)\\n        .slice(0, limit);\\n}\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"personalityjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#personalityjs\",\"className\":\"anchor-link\",\"children\":\"personality.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Personality and mood management.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"key-functions-4\",\"children\":[\"$\",\"a\",null,{\"href\":\"#key-functions-4\",\"className\":\"anchor-link\",\"children\":\"Key Functions\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Personality\\nexport async function getPersonality()\\nexport async function updateTrait(trait, value)\\nexport async function resetPersonality()\\nexport async function evolveTrait(trait, delta)\\n\\n// Mood\\nexport async function getCurrentMood()\\nexport async function setMood(mood, intensity)\\nexport async function shiftMood(mood, amount)\\n\\n// Relationships\\nexport async function getRelationshipStage(userId)\\nexport async function updateRelationship(userId, interaction)\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"trait-evolution\",\"children\":[\"$\",\"a\",null,{\"href\":\"#trait-evolution\",\"className\":\"anchor-link\",\"children\":\"Trait Evolution\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"export async function evolveTrait(trait, delta) {\\n    const current = await getPersonality();\\n    let newValue = current[trait] + delta;\\n\\n    // Clamp between 0.1 and 0.9\\n    newValue = Math.max(0.1, Math.min(0.9, newValue));\\n\\n    db.prepare(`\\n        UPDATE personality SET ${trait} = ?, last_updated = ?\\n        WHERE id = 1\\n    `).run(newValue, new Date().toISOString());\\n\\n    return newValue;\\n}\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"toolsjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#toolsjs\",\"className\":\"anchor-link\",\"children\":\"tools.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Tool call framework.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"key-functions-5\",\"children\":[\"$\",\"a\",null,{\"href\":\"#key-functions-5\",\"className\":\"anchor-link\",\"children\":\"Key Functions\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Tool definitions\\nexport function getToolDefinitions()\\nexport function getEnabledTools()\\n\\n// Tool execution\\nexport async function executeToolCall(name, args)\\nexport async function handleToolCalls(response, message)\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"tool-registry\",\"children\":[\"$\",\"a\",null,{\"href\":\"#tool-registry\",\"className\":\"anchor-link\",\"children\":\"Tool Registry\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"const toolRegistry = {\\n    generate_image: {\\n        definition: { /* JSON Schema */ },\\n        handler: handleImageGeneration,\\n        enabled: () =\u003e process.env.IMAGE_GEN_ENABLED === 'true'\\n    },\\n    roll_dice: {\\n        definition: { /* JSON Schema */ },\\n        handler: handleDiceRoll,\\n        enabled: () =\u003e true\\n    }\\n    // Add more tools here\\n};\\n\\nexport function getEnabledTools() {\\n    return Object.values(toolRegistry)\\n        .filter(tool =\u003e tool.enabled())\\n        .map(tool =\u003e tool.definition);\\n}\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"llmevaluatorjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#llmevaluatorjs\",\"className\":\"anchor-link\",\"children\":\"llmEvaluator.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"NEW\"}],\" - Centralized LLM-powered evaluation service.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"key-functions-6\",\"children\":[\"$\",\"a\",null,{\"href\":\"#key-functions-6\",\"className\":\"anchor-link\",\"children\":\"Key Functions\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Mood evaluation\\nexport async function evaluateMood(message, context)\\n// Returns: { sentiment, suggestedMood, moodConfidence, detectedPatterns, ... }\\n\\n// Relationship evaluation\\nexport async function evaluateRelationship(userMessage, botResponse, context)\\n// Returns: { interactionQuality, trustIndicators, relationshipDeltas, ... }\\n\\n// Jarvis intent parsing\\nexport async function parseJarvisIntent(message, context)\\n// Returns: { isCommand, command, confidence, params, requiresConfirmation, ... }\\n\\n// Utilities\\nexport function isAvailable()      // Check if evaluator can be called\\nexport function getCacheStats()    // Cache and rate limit stats\\nexport function clearCache()       // Clear response cache\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"configuration\",\"children\":[\"$\",\"a\",null,{\"href\":\"#configuration\",\"className\":\"anchor-link\",\"children\":\"Configuration\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"const EVALUATOR_MODEL = config.LLM_EVALUATOR_MODEL || 'x-ai/grok-4.1-fast';\\nconst CACHE_TTL = config.LLM_EVALUATOR_CACHE_TTL || 60000;\\nconst RATE_LIMIT_CALLS = config.LLM_EVALUATOR_RATE_LIMIT || 30;\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"features\",\"children\":[\"$\",\"a\",null,{\"href\":\"#features\",\"className\":\"anchor-link\",\"children\":\"Features\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Rate limiting\"}],\": 30 calls/minute with queue\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Response caching\"}],\": 60s TTL on content hash\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Graceful fallback\"}],\": Returns \",[\"$\",\"code\",null,{\"children\":\"null\"}],\" to signal fallback needed\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Deterministic\"}],\": Temperature 0.1 for consistent evaluations\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"admincommandsjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#admincommandsjs\",\"className\":\"anchor-link\",\"children\":\"adminCommands.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Jarvis Mode implementation with LLM-first parsing.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"key-functions-7\",\"children\":[\"$\",\"a\",null,{\"href\":\"#key-functions-7\",\"className\":\"anchor-link\",\"children\":\"Key Functions\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Main entry point (now LLM-first)\\nexport async function parseAndExecuteAdminCommand(message, context)\\n\\n// LLM execution\\nasync function executeFromLLMIntent(llmIntent, originalMessage, context)\\n\\n// Fallback parsing\\nexport function tryPatternMatch(message)\\nexport function analyzeIntent(message)\\nexport function extractEntities(message)\\n\\n// Command execution\\nexport async function executeCommand(command, params, context)\\n\\n// Utilities\\nexport function getAvailableAdminCommands()\\nexport function isConfirmationPending(userId)\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"parsing-pipeline\",\"children\":[\"$\",\"a\",null,{\"href\":\"#parsing-pipeline\",\"className\":\"anchor-link\",\"children\":\"Parsing Pipeline\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Stage 1: Check pending confirmations\\n// Stage 2: LLM Intent Parser (PRIMARY)\\n// Stage 3: Pattern Matching (FALLBACK)\\n// Stage 4: Intent Keywords (FALLBACK)\\n// Stage 5: Context Substitution\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"command-registration\",\"children\":[\"$\",\"a\",null,{\"href\":\"#command-registration\",\"className\":\"anchor-link\",\"children\":\"Command Registration\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"const commands = {\\n    give_bebits: {\\n        name: 'give_bebits',\\n        patterns: [/* regex patterns for fallback */],\\n        execute: async (match, context) =\u003e {\\n            const target = match[1];\\n            const amount = parseInt(match[2]);\\n            await addBebits(target, amount);\\n            return { success: true, message: `Gave ${amount} bebits to \u003c@${target}\u003e!` };\\n        }\\n    },\\n    // ... more commands\\n};\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"server-memory-services\",\"children\":[\"$\",\"a\",null,{\"href\":\"#server-memory-services\",\"className\":\"anchor-link\",\"children\":\"Server Memory Services\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The server memory system consists of four services that work together.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"messageingestionjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#messageingestionjs\",\"className\":\"anchor-link\",\"children\":\"messageIngestion.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Captures ALL server messages for server-wide memory.\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Key exports\\nexport async function ingestMessage(discordMessage)    // Store raw message\\nexport function calculateImportanceScore(message)       // Score 0-1\\nexport function shouldEmbed(score, threshold)          // Check threshold\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Importance Factors\"}],\":\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Content length (0.15), Questions (0.20), Mentions (0.15)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Topic keywords (0.15), Emotional intensity (0.10)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Breaking silence (0.10), Attachments (0.05)\"}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"embeddingqueuejs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#embeddingqueuejs\",\"className\":\"anchor-link\",\"children\":\"embeddingQueue.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Background batch processing for embeddings.\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Key exports\\nexport function startProcessor()      // Start background processing\\nexport function stopProcessor()       // Stop processor\\nexport function getQueueStats()       // Get pending/completed/failed counts\\nexport function bufferToEmbedding()   // Convert BLOB to array\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Configuration\"}],\":\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Batch size: 10 messages\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Interval: 30 seconds\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Max retries: 3\"}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"servermemoryjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#servermemoryjs\",\"className\":\"anchor-link\",\"children\":\"serverMemory.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Retrieval API for server-wide memories.\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Key exports\\nexport async function getAmbientContext(guildId, channelId, options)\\nexport async function searchServerMemories(query, options)\\nexport function getActiveTopics(guildId, limit)\\nexport async function buildServerMemoryContext(guildId, channelId, query, userId)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Retrieval Modes\"}],\":\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"ambient\"}],\": Recent activity awareness\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"deep\"}],\": Semantic search for specific details\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"topic_track\"}],\": Ongoing discussions\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"summarizerjs\",\"children\":[\"$\",\"a\",null,{\"href\":\"#summarizerjs\",\"className\":\"anchor-link\",\"children\":\"summarizer.js\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Periodic channel summarization.\"}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"javascript\",\"children\":\"// Key exports\\nexport function startScheduler(guildId)        // Start hourly/daily jobs\\nexport function stopScheduler()                // Stop all jobs\\nexport async function runHourlySummaries()     // Manual hourly run\\nexport async function runDailySummaries()      // Manual daily run\\nexport async function triggerSummary()         // Manual single summary\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Schedule\"}],\":\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Hourly: Top of each hour (channels with 5+ messages)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Daily: 2:00 AM (channels with 20+ messages)\"}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"service-dependencies\",\"children\":[\"$\",\"a\",null,{\"href\":\"#service-dependencies\",\"className\":\"anchor-link\",\"children\":\"Service Dependencies\"}]}],\"\\n\",[\"$\",\"$L15\",null,{\"language\":\"$undefined\",\"children\":\"database.js              openrouter.js\\n(standalone)             (standalone)\\n    â†‘                        â†‘\\n    â”‚                        â”‚\\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\\n             â”‚\\n        llmEvaluator.js\\n        (rate limiting, caching)\\n             â†‘\\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”\\n    â”‚        â”‚        â”‚\\n    â†“        â†“        â†“\\nmemory.js  personality.js  adminCommands.js\\n    â†‘           â†‘              â†‘\\n    â”‚           â”‚              â”‚\\n    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚\\n          â”‚                    â”‚\\n       chat.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Key dependency changes:\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"llmEvaluator.js\"}],\" depends on \",[\"$\",\"code\",null,{\"children\":\"openrouter.js\"}],\" for API calls\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"personality.js\"}],\" now imports \",[\"$\",\"code\",null,{\"children\":\"evaluateMood\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"evaluateRelationship\"}],\" from \",[\"$\",\"code\",null,{\"children\":\"llmEvaluator.js\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"adminCommands.js\"}],\" now imports \",[\"$\",\"code\",null,{\"children\":\"parseJarvisIntent\"}],\" from \",[\"$\",\"code\",null,{\"children\":\"llmEvaluator.js\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"best-practices\",\"children\":[\"$\",\"a\",null,{\"href\":\"#best-practices\",\"className\":\"anchor-link\",\"children\":\"Best Practices\"}]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Keep services focused\"}],\" - One responsibility per module\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Avoid circular dependencies\"}],\" - Use dependency injection if needed\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Handle errors gracefully\"}],\" - Return meaningful error objects\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Log important operations\"}],\" - For debugging and monitoring\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Use transactions\"}],\" - For multi-table operations\"]}],\"\\n\"]}]]\n"])</script></body></html>